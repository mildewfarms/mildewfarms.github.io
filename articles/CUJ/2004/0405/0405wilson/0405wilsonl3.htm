<html><head><title>May 04: Mapping recls to COM Collections Delving into the Component Object Model</title></head><body BGCOLOR="#ffffff" LINK="#0000ff" VLINK="#330066" ALINK="#ff0000" TEXT="#000000"><!--Copyright &#169; C/C++ Users Journal--><h4>Listing 3:	SearchCollection::get__NewEnum().</i></h4><pre>STDMETHODIMP SearchCollection::get__NewEnum(LPUNKNOWN *ppenum){  HRESULT hr;  if(NULL == ppenum)  {    hr = E_POINTER;  }  else  {    *ppenum = NULL;    EnumEntry *pee  = new CComObject&lt;EnumEntry&gt;();    if(NULL == pee)    {      hr = E_OUTOFMEMORY;    }    else    {      hr = S_OK;      if( NULL == m_info.hSrch &amp;&amp;          !m_info.bEmpty)      {        // This collection has already been used to spawn a         // search, so we need to start another one.        recls_rc_t rc = Recls_Search( . . . );        if(rc != RECLS_RC_NO_MORE_DATA)        {          m_info.bEmpty = true;        }        else if(RECLS_FAILED(rc))        {          set_error_info_from_recls_rc_t(rc);          delete pee;          hr = E_FAIL;        }      }      if(SUCCEEDED(hr))      {        pee-&gt;SetVoid(&amp;m_info);        ATLASSERT(NULL == m_info.hSrch);        *ppenum = static_cast&lt;IEnumVARIANT*&gt;(pee);        (*ppenum)-&gt;AddRef();      }    }  }  return hr;}</body></html>