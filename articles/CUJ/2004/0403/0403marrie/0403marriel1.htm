<html><head><title>March 04: </title></head><body BGCOLOR="#ffffff" LINK="#0000ff" VLINK="#330066" ALINK="#ff0000" TEXT="#000000"><!--Copyright &#169; C/C++ Users Journal--><h4>Listing 1:	<i>Adding new elements to the rollback list.</i></h4><pre>template &lt;class T, class ForwardIterator&gt;void strong_insert(std::set&lt;T&gt; c, ForwardIterator first, ForwardIterator last){  typedef typename std::set&lt;T&gt;::iterator set_iterator;  std::deque&lt;set_iterator&gt; rollback_temp;  try {    while ( first != last ) {      std::pair&lt;set_iterator,bool&gt; result = c.insert( *first );      if ( result.second ) {        try {          rollback_temp.push_back(result.first);        } catch ( ... ) {          c.erase( result.first );          throw; // skip to outer catch block        }      }      ++first;    }  } catch ( ... ) {    typedef typename std::deque&lt;set_iterator&gt;::iterator deque_iterator;    // remove rollback list elements    for ( deque_iterator i = rollback_temp.begin();           i != rollback_temp.end();          ++i ) {      c.erase( *i );    }    throw;  }}</body></html>