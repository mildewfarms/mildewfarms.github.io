<h1>Gentoo Linux</h1>
<h3>By Trevor Marshall</h3>

<P>It has been 10 years since Patrick Volkerding announced the Slackware 1.00 Linux distribution (<a href="http://www.slackware.org/announce/1.0.php">http://www.slackware.org/announce/1.0.php</a>). The succeeding Slackware releases served me well, but for a few years Slackware fell a little behind in the GUI race and the lure of a well-integrated KDE forced me to take a look at Red Hat and SuSE. 

<P>When I first booted the SuSE installation CD I became aware of a major problem&#151;new distributions were "optimized" for the most recent CPUs. My aging Toshiba Libretto mini-laptop has a 133-MHz Pentium MMX, but even when I cross-compiled the SuSE kernel specifically for PENTIUM-MMX, utilities and compilers would not run unless they, too, were recompiled. (I ran into the same problem when upgrading my DSL firewall/server, which even today runs a 450-MHz Celeron Mendocino.)

<P>After weeks of chasing my tail, I decided to take the plunge into a source-code-based distribution&#151;one where I had source code for everything, and where I could select the level of optimization needed for each of my machines. I found this in Gentoo Linux (<a href="http://www.gentoo.org/">http://www.gentoo.org/</a>), which in some ways is a distribution created primarily for programmers who optimize and reoptimize their code.

<P>In addition to being source based, Gentoo has Portage, a package-handling system inspired by the package tools available within BSD. Whenever an update is required for a component (for example, if a security glitch is found in Apache), you don't need to manually integrate the patches. Two Gentoo commands&#151;<b>emerge sync</b> and <b>emerge -u apache</b>&#151;download a new package source tree, compile it, and bring your system fully up to date.

<P>The first command (<b>emerge sync</b>) merges in a new sync tree, effectively downloading a list of the latest versions of each package in the Gentoo distribution. The second command (<b>emerge -u apache</b>) then downloads and installs the latest version of Apache, together with all the libraries and applications it needs to function.

<P>Portage automatically handles package interdependencies. For instance, it used to take hours to compile a new version of AirSnort or Kismet into SuSE. Interdependence upon each other, Ethereal, and PCAP usually created a version nightmare. But installation of the component from the latest Gentoo net-wireless package (<a href="http://www.gentoo-portage.com/browseportage.php?category=66/">http://www.gentoo-portage.com/browseportage.php?category=66/</a>) ensures all dependencies are satisfied, and makes installation and maintenance a breeze.

<P>Portage has a <b>-p</b> switch (the "pretend" function) that lets you test the functions performed by an emerge command. For example, <b>emerge -pu apache</b> lists all the tasks needed to upgrade apache, so that you can manually assure yourself that Portage is going to do all the right things.

<h3>Installing Gentoo</h3>

<P>When installing Gentoo, you first must keep the target processor in mind&#151;x86, PPC, Sparc, Alpha, AMD64, MIPS, ARM, or IA64. Different targets have different levels of support. I have only used the x86 and PPC versions. Although both were complete and reliable, in this article I'll focus on the x86 installation process. 

<P>Gentoo has a database dedicated to cataloging the most recent versions of each available module for each available architecture (<a href="http://packages.gentoo.org/">http://packages.gentoo.org/</a>). The database is updated daily with a list of all upgraded packages and is worth watching&#151;not so much to keep track of updates, but to look at new applications and features as they are integrated into Gentoo.

<P>Gentoo initially boots from a 96-MB CD (called the "basic LiveCD"), then brings down source for each application package from Internet mirrors. LiveCD is an excellent mini-distribution on its own, and can be used for system maintenance and debug, performing many of the system disk recovery tasks for which the Knoppix distribution (<a href="http://www.knopper.net/knoppix/index-old-en.html">http://www.knopper.net/knoppix/index-old-en.html</a>) has proven useful. Both LiveCD and Knoppix seem to be able to boot on just about any x86 system, and "magically" recognize all the installed hardware and peripherals. The ISO image for the LiveCD can be downloaded from any of the mirrors using the path gentoo/releases/x86/1.4/livecd/basic/.

<P>Step-by-step instructions (<a href="http://www.gentoo.org/doc/en/gentoo-x86-install.xml">http://www.gentoo.org/doc/en/gentoo-x86-install.xml</a>) make the installation straightforward, although you do have to use your brain cells a little. Gentoo installation puts you in control. There is no master installation program. The Portage packages you select are downloaded from the Internet, compiled, and installed onto your target hard disk. You get to do all the configuration, and you get the gratification when your kernel first boots.

<P>One of the first tasks is to select a kernel version. There's an array of choices (<a href="http://packages.gentoo.org/packages/?category=sys-kernel">http://packages.gentoo.org/packages/?category=sys-kernel</a>), but "gentoo-sources" is a good place for starting your first system. Then, you need to select how many of the really fundamental utilities you want in place at that first boot. There are three tarballs to choose from. The smallest contains only the kernel and the most basic tools, while tarball level III contains a good assortment of system utilities.

<P>It can take 24 hours to compile the larger applications (such as X, KDE, or Gnome), so the most recent distribution (1.4) has been streamlined with the addition of a number of precompiled executables. basic LiveCD has therefore swollen to fill a complete disk. A second CD has been added, with precompiled versions of KDE, GNOME, OpenOffice, and Mozilla. Downloading or purchasing the two-CD set saves time.

<P>In addition to Gnome and KDE, most of the compact X11 window managers (<a href="http:// packages.gentoo.org/packages/?category=x11-wm/">http:// packages.gentoo.org/packages/?category=x11-wm/</a>) are available for installation. My Libretto laptops only have 32 MB of RAM, which makes trying to run Gnome or KDE frustrating. Consequently, I installed IceWM (<a href="http://www.icewm.org/">http://www.icewm.org/</a>) and ended up with enough remaining physical memory to comfortably run either Mozilla-Firebird (<a href="http://packages.gentoo.org/packages/?category=net-www;name=mozilla-firebird/
">http://packages.gentoo.org/packages/?category=net-www;name=mozilla-firebird/</a>) or Kismet (<a href="http://www.kismetwireless.net/">http://www.kismetwireless.net/</a>).

<P>Once you have created your installation, you can easily maintain it with the Portage utilities. Still, the initial Gentoo setup does exercise your programming abilities since just about every system parameter is configurable. Not only does the normal Linux require CPU variables to be manually configured, but because this is a kernel you compile locally, you also have to remember to change the default CPU definitions in /etc/make.conf. The CFLAGS variable passes the default host CPU type to the C/C++ compilers during Linux system and application builds. A list of switches for all the supported processor types&#151;from i386 to SPARC&#151;is available from freehackers.org (<a href="http://www.freehackers.org/gentoo/gccflags/flag_gcc3.html">http://www.freehackers.org/gentoo/gccflags/flag_gcc3.html</a>).

<P>Gentoo.org has made available a Linux Installation LiveCD (<a href="http://store.gentoo.org/index.php?cat=21&action=browse/">http://store.gentoo.org/index.php?cat=21&action=browse/</a>) optimized for processors such as:

<ul>

<li>i386 (called the "x86 version").
<li>i686 (Pentium Pro/II, Celeron 266–533 MHz, original Athlon).
<li>Pentium 3 (Pentium 3, Celeron 1 GHz–1.4 GHz).
<li>Pentium 4 (Celeron 1.7GHz+, Pentium 4, Pentium M/Centrino, P4 Xeon).
<li>Athlon XP (Athlon XP, MP, Opteron in 32-bit mode).
<li>PowerPC G3.
<li>PowerPC G4.

</ul>

<P>In addition, a PowerPC G3/G4 LiveCD that boots directly in Linux, and which includes KDE, GNOME, and the OpenOffice and Koffice applications, is available. Consequently, there is no longer any need to struggle with CFLAGS during the initial boot, or to cross-compile your Linux executable on another system. Just select a CD with the level of processor optimization you want for any particular target machine, and then install Gentoo with confidence.

<P>Gentoo's BSD influence also shows in the choice of Grub as the boot loader. If you are more familiar with Lilo, you should execute <b>emerge -u lilo</b>, then edit /etc/lilo.conf in the usual way.
Being a source-code-based distribution, Gentoo has solid native C and C++ support. Since you rely on these native compilers to make your Gentoo kernel work properly, they need to be complete, with up-to-date revisions of the native libraries (libc6/glibc2). 

<P>Gentoo also has excellent support for cross-platform software development. It provides a cc-config wrapper that is able to call any of the available cc compilers, including the cross-compilers for x86, PPC, Sparc, Alpha, MIPS, ARM, and AMD64 targets. Similarly, the gcc-config wrapper changes the active GCC compiler. GCC additionally can produce code for HPPA and IA64 target processors. There are a number of special GCC builds for the Sparc and MIPS kernels, as well as a hardened GCC with transparent and semitransparent -pie -fPIC -fstack-protector support. 

<P>Among Gentoo's specialty C/C++ compilers are: tcc (<a href="http://fabrice.bellard.free.fr/tcc/">http://fabrice.bellard.free.fr/tcc/</a>), a small (100K) x86 C compiler; ccc, Compaq's enhanced C compiler for the Alpha platform; and icc, Intel's Pentium-optimized C++ compiler for Linux. uclibc is a C library for developing embedded Linux systems. Gentoo also has standard packages for the C++ implementation of the Atlas protocol (used in role playing games at Worldforge) and SIP (<a href="http//www.riverbankcomputing.co.uk/sip/">http//www.riverbankcomputing.co.uk/sip/</a>), a tool for generating bindings for C++ classes so that they can be used by Python.

<h3>Conclusion</h3>
<P>For the most part, programmers don't need a Linux distribution with the ability to simultaneously deploy 200 copies across an enterprise. What we need is a distribution where bugs are fixed quickly, and where new tools can be smoothly integrated. Gentoo has proven itself just such a programmer's distribution. 

<hr><i>Trevor Marshall is an engineering consultant, specializing in RF and hardware design and Linux internals. He can be contacted at <a href="http//www.trevormarshall.com/">http//www.trevormarshall.com/</a>.<hr>