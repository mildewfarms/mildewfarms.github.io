<html><head><title>April 04: </title></head><body BGCOLOR="#ffffff" LINK="#0000ff" VLINK="#330066" ALINK="#ff0000" TEXT="#000000"><!--Copyright &#169; C/C++ Users Journal--><h4>Listing 2:	<i>Base state machine classes.</i></h4><pre>#ifdef DERIVE_STATE_MACHINE #define THIS            (*this)template &lt;class T, class EV, class CMP = std::less&lt;EV&gt; &gt;class StateMachine : private T{public:     explicit StateMachine( State&lt;T,EV,CMP&gt;* const stStart ) :         T(), m_stStart(stStart), m_stCurrent(stStart), m_stThis(eStopped) {}// Aggregated Version of State Machine#else#define THIS            (*m_T)template &lt;class T, class EV, class CMP = std::less&lt;EV&gt; &gt;class StateMachine{private:    T* m_T;public:     explicit StateMachine( T* _T, State&lt;T,EV,CMP&gt;* const stStart ) :       m_T(_T), m_stStart(stStart), m_stCurrent(stStart), m_stThis(eStopped) {}    ~StateMachine() { delete m_T; }#endif      // DERIVE_STATE_MACHINE    ... // other API functions not shownprivate:     State&lt;T,EV,CMP&gt;* const m_stStart;    State&lt;T,EV,CMP&gt;* m_stCurrent;};</body></html>