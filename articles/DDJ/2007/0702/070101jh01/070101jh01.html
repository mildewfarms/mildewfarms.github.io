<html>
<head>
<title>Ajax Debugging With Firebug</title>
<link rel="Stylesheet" rev="Stylesheet" href="../../../../forms/Layout.css" type="text/css">
<link rel="Stylesheet" rev="Stylesheet" href="../../../../forms/FontStyles.css" type="text/css">
<link rel="Stylesheet" rev="Stylesheet" href="../../../../forms/newarticle.css" type="text/css">
<script src="../../../../forms/popwindow.js"></script>
</head>

<body BGCOLOR="#ffffff" LINK="#0000ff" VLINK="#330066" ALINK="#ff0000" TEXT="#000000">
<!--Copyright &#169; Dr. Dobb's Journal-->
<p><i>Dr. Dobb's Journal</i> February 2007</p>

<h1>Ajax Debugging With Firebug</h1>
<h2>A Firefox extension that makes web development fun again</h2>


<h3>By Joe Hewitt</h3>


<I>Joe is the Chief Technology Officer at Parakey Inc. and is the creator of Firebug. Contact  him at joe@joehewitt.com. </I>

<hr>




<p>In the early days of the Web, all you needed to know to craft web sites was HTML. More than a decade later, the situation has changed. Modern web sites are a product of several distinct technologies, and web developers must be proficient in all of them&#151;HTML, CSS, JavaScript, and the DOM, among others. </p>

<p>Then a couple of years ago, AJAX came along and every web development tool on the market became obsolete overnight. Today you can no longer rely strictly on tools that were designed for the creation of static pages. This is where Firebug comes in.</p>

<p>Firebug, an extension I wrote for the Firefox browser (www.mozilla.com), makes web development fun again. Combined with your favorite text editor, the freely available Firebug (www.joehewitt.com/software/firebug/) is a highly productive IDE for the complete stack of AJAX technologies.</p>


<h3>Firebug Overview</h3>

<p>Firebug's biggest draw is its convenience. As you browse with Firefox, you can open Firebug at any time to begin working on any page. Firebug appears either as a separate window or as a small panel at the bottom of your browser. Tabbed browsing and Firebug are best friends; each tab can hold a separate Firebug session, which always reflects the current page as you browse.</p>

<p>Firebug breaks the page down into a set of tabs that depict its most important aspects&#151;HTML, CSS, JavaScript, the DOM, network activity, and a console for errors and log messages. No tab is an island; Firebug lets you browse code just as you browse the Web by presenting objects as hyperlinks that can take you from one view to another.</p>











<h3>The Firebug Workflow</h3>

<p>Firebug knows that most developers have a tight relationship with their favorite text editor, and it isn't out to make you switch. Instead, Firebug gives you a place to experiment by playing with a live page in a separate text editor. This makes the browser's Reload button the equivalent of the Run button in a standalone IDE. For this reason, Firebug preserves the state of its views when you reload, so you can glide smoothly between your editor and browser without losing your place. However, you needn't always reload the page. Firebug lets you modify the page in place and see the result immediately.</p>


<h3>Exploring Objects</h3>

<p>Web development starts and ends with HTML, so Firebug gives you a lightning-quick way to find and inspect HTML elements that you are interested in. Hit the Inspect button, point your mouse at any part of the page, and Firebug unveils its place in the live HTML source. As you continue to move your mouse, Firebug follows you, which makes for a fun way to learn about the structure of web pages others have created.</p>

<p>An AJAX-ian web page never stands still. HTML nodes are constantly being created, modified, and removed by JavaScript. As changes occur, Firebug's HTML view stays up to date in real-time and highlights the changes in yellow. When you see things moving and changing in a page, this gives you a quick way to learn how it was accomplished.</p>

<p>The HTML view includes a second strip of tabs that give you other ways to inspect an HTML node. The CSS tab shows you the full cascade of CSS rules that affect the style of the selected node. One quick glance at the CSS view solves the mystery of why something doesn't look the way you expected it to.</p>
<h3>Pixel Perfection</h3>

<p>One issue that confounds new CSS developers is the box model, which defines the way a box is sized and where its contents are placed. The box model can be hard to pick up with the naked eye because of the transparency of margins and padding.</p>

<p>Firebug helps visualize the previously invisible. When your mouse moves over anything that represents an HTML element in Firebug, the element's rectangle in the page is highlighted, and its margin, border, padding, and content are each shaded a different color.</p>

<p>Positioning elements with CSS can also be challenging because you must always remain conscious of the container that defines its local coordinate space. Firebug helps you visualize this by using rulers and guidelines. While viewing the Layout tab, moving your mouse inside the box causes rulers to appear along the bounds of the element's container. Guidelines also appear tangent to each edge of the box so that you can see where the edges intersect the rulers.</p>











<h3>Experimenting and Tweaking</h3>

<p>Firebug is not just an inspector, it's also an editor. Virtually every object in Firebug can be edited inline just by clicking or double-clicking it. As you type, Firebug applies changes immediately, giving you constant feedback. All editors support autocomplete. The CSS editor autocompletes as you type, and the DOM editor autocompletes property names when you hit the Tab key.</p>

<p>The Firebug command line, found at the bottom of the Console tab, is no different than any command line you've used in UNIX, DOS, or Windows&#151;except that it accepts commands written in JavaScript.</p>

<p>The result of executing each command is displayed in the console. The results are not just static text, they are hyperlinks. For example, if the result of a command is an HTML element, clicking the link takes you to the HTML tab with the element selected, and moving your mouse over the link highlights the element itself in the page above.</p>

<p>The command line is more than just a place for one-liners. You can expand it to become a full-size editor. When you're working in your external editor, you can quickly copy-and-paste code into the Firebug editor to execute them immediately and how they effect the live page. Once you've gotten the result you'd like, copy the finished code and paste it back into your editor.</p>


<h3>Network Activity</h3>

<p>The core idea of AJAX is that small snippets of data will be fetched from the server using a channel called "<i>XMLHttpRequest</i>", then used to update the page. Without Firebug, all that traffic is invisible. But with Firebug, you can observe the progress of each request and inspect the sent/received text.</p>

<p>There are two places that you can observe <i>XMLHttpRequests</i>. The first is the Console tab. Each request is logged to the console so that you can see when it took place in the flow of other messages. You can also click each request to expand it and see the headers and text in transit. </p>

<p>The other place to observe <i>XMLHttpRequests</i> is in the Net tab (Figure 1). This tab shows a real-time view of every file loaded in the page, including HTML, CSS, JavaScript, Flash, and image files. The timeline of requests is animated as each one moves across the wire, helping you understand when each one began and ended, and how large it was.</p>


<div>
    
<div class="smallcap">&#91;Click image to view at full size&#93;</div>
<!--  -->    
<img class="illowide" src="070101jh01_f1.gif" onclick = "popimage(this,'www.ddj.com - Ajax Debugging With Firebug - Figure 1')">

<div class="caption">
Figure 1: Net tab.
</div>
</div>












<h3>Log Debugging</h3>

<p>Firebug is not just a way for you to examine a page from the outside; it is also a place for you to send messages from within the page itself. To facilitate this, Firebug provides every web page loaded in Firefox with the console object that contains a number of functions for logging. As your script executes, you can fill the console with an ongoing stream of data for you to analyze. </p>

<p>The simplest way to write to the Firebug console is by calling the <i>console.log</i> function:</p>

<pre class="code">

 &gt;&gt;&gt; console.log("Hello World!")
 Hello World

</pre>
<p>When you want to write program data to the console, you have a number of options. First, <i>console.log</i> accepts an infinite number of arguments that are joined together when written to the console:</p>

<pre class="code">

&gt;&gt;&gt; console.log
    ("My aunt", auntName, 
        "has", sonCount, "sons.");
My aunt Susie has 3 sons.


</pre>
<p>The function is also capable of formatting arguments in the tradition of C's <i>printf</i>. The same line, therefore, can be written as:</p>

<pre class="code">

&gt;&gt;&gt; console.log
    ("My aunt %s has %d sons.", 
        auntName, sonCount);
My aunt Susie has 3 sons.

</pre>
<p>The output of <i>console.log</i> is an undecorated line of text. If you'd like to add some visual distinction to each line to make the log easier to read, you can try one of <i>console.log'</i>s cousins&#151;<i>debug, info, warning, </i>and <i>error</i>:</p>

<pre class="code">

&gt;&gt;&gt; console.debug
    ("%s - %d", title,  
        lastAccess)
Guestbook - 1342391823

&gt;&gt;&gt; console.info
    ("%d new objects created", 
        objects.length)
18 new objects created

&gt;&gt;&gt; console.warning
    ("The connection to %s was 
        aborted.", url)
The connection to 
    http://example.com was aborted.

&gt;&gt;&gt; console.error
    ("The file '%s' could not 
        be opened.", filePath)
The file 'c:/data.txt' could 
    not be opened.


</pre>
<p>Another advantage of using <i>debug, info, warning,</i> and <i>error</i> is that they output a hyperlink to the line of the script where they were called. When you click this link, the Firebug debugger opens the pertinent script and highlights the line that caused the log message.</p>

<p>One problem with logging is that it can easily lead to a long list of messages that blur together, making it difficult to understand when they were called in the program flow. The console object provides the functions <i>group</i> and <i>groupEnd</i> to create nested blocks that illustrate which processes are on the stack when a message is logged.</p>

<p>Most programming consoles offer little more than lifeless streams of text, but the Firebug console is fully interactive. If you pass a structured object (such as a JavaScript object or DOM element) to any logging function, the result is not a textual snapshot of that object but a hyperlink. Click the link to open the relevant Firebug tab and inspect the object in greater detail. An HTML element, for instance, is shown in the live HTML inspector. A function is shown in the context of its source file in the Script tab. All other objects are shown in the DOM inspector:</p>

<pre class="code">

&gt;&gt;&gt; console.log
    ("element:", document.body)
element: body

&gt;&gt;&gt; console.log
    ("header: %o",
        document.getElementById
            ("header1"))
header: h1#header1

</pre>





<h3>Breakpoint Debugging</h3>

<p>Firebug's Script tab contains a powerful debugger that lets you pause JavaScript execution on any line. You can then step forward line-by-line to analyze how the state of the program  changes in real time. Breakpoints need not be triggered indiscriminately; Firebug lets you specify the circumstances under which a breakpoint is triggered.</p>


<h3>Setting Breakpoints</h3>

<p>The simplest way to set a Firebug breakpoint is to find the desired script in the Script tab, then click on the number of the line at which execution should stop. The debugger pauses execution upon reaching that line and shows you the current call stack (Figure 2). The watch pane on the right lets you inspect the value of local variables. If the value is an object, you can click on the object to view its properties, just as you can in all other Firebug contexts. You can also enter arbitrary JavaScript expressions and trace their values as execution progresses.</p>




<div>
    
<div class="smallcap">&#91;Click image to view at full size&#93;</div>
<!--  -->    
<img class="illowide" src="070101jh01_f2.gif" onclick = "popimage(this,'www.ddj.com - Ajax Debugging With Firebug - Figure 2')">

<div class="caption">
Figure 2: Debugger with breakpoint set and execution paused.
</div>
</div>




<p>While the debugger is stopped, the Firebug toolbar contains a horizontal view of every function in the call stack. Click a function to move to the file and line where its execution stopped and inspect the local variables in that context.</p>


<h3>Conditional Breakpoints</h3>

<p>Sometimes you'd rather not have the debugger stop every time a line is hit, but rather, only when certain conditions are true. Right-click a line number in Firebug's Script tab to open a little bubble where you can enter a JavaScript expression. The debugger pauses execution only when the expression evaluates to be true.</p>


<h3>Error Breakpoints</h3>

<p>One of the most common reasons to use the debugger is to investigate an error that you weren't expecting. When an error occurs in JavaScript, a detailed description of the error is logged to Firebug's Console. After reading the message, you might wish you could have been in the debugger when the error occurred so that you could inspect the objects and call stack when it occurred.</p>

<p>Error messages have a red button that you can toggle to set a special kind of breakpoint that stops whenever the exact error occurs again. Toggle this button on, then try to reproduce the error. Firebug switches you to the debugger when it happens.</p>

<p>Sometimes, Firebug can save you the trouble of having to reproduce the error. Error messages have an attached stack trace that you can see by expanding the description. The trace exposes not only the names of the functions on the stack, but also the values of each of the arguments that were passed to each function.</p>


<h3>The debugger Keyword</h3>

<p>When working in your editor, it's sometimes easier to locate the spot where you want to set a breakpoint than to switch to Firebug and find it separately. JavaScript has the built-in keyword <i>debugger</i>, which comes in handy. Put the <i>debugger</i> keyword on any line where you want the debugger to stop, and script execution pauses when that line is reached&#151;just as if you'd set a breakpoint within Firebug.</p>












<h3>Profiling</h3>

<p>Finding and squashing bugs is only half the battle; the other half is identifying and killing performance bottlenecks. Firebug gives you two ways to measure the performance of your scripts and separate the tortoises from the hares.</p>

<p>Traditionally, the most low-tech way to measure performance is to record the time before and after a suspect code block and then log the delta. Firebug gives you a pair of functions, <i>time</i> and <i>timeEnd</i>, which do this:</p>

<pre class="code">

 console.time("loading");
 loadWidgets();
 console.timeEnd("loading");

</pre>
<p>This technique works well if you already have an idea where your bottlenecks are, but what if you don't? Firebug includes a JavaScript profiler that gives you detailed reports on the performance of every function called during a given period.</p>

<p>There are two ways to start the profiler. The most direct is to click the Profile button in the toolbar of the Firebug Console tab. While this button is toggled, the profiler is working in the background, recording data about each function call. When you're ready to see a report, click the Profile button again, and you see a report that lists every function that was called, how many times it was called, and different statistics about the aggregate time spent in the function.</p>

<p>The other way to start the profiler is from code. The console object has two functions, <i>profile</i> and <i>profileEnd</i>, which let you create profile reports in between specific blocks of code in your scripts:</p>

<pre class="code">

 console.profile();
 loadWidgets();
 console.profileEnd
    ("Loading widgets");

</pre>

<h3>Conclusion</h3>

<p>In short, FireBug lets you explore the far corners of the DOM. All the tools you need to poke, prod, and monitor your JavaScript, CSS, HTML and Ajax are brought together into one seamless experience, including a debugger, error console, command line, and a variety of fun inspectors.</p>













</body>
</html>