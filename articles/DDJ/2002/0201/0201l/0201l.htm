<html><head><title>Jan02: Java Q&A</title></head><body BGCOLOR="#ffffff" LINK="#0000ff" VLINK="#330066" ALINK="#ff0000" TEXT="#000000"><!--Copyright &#169; Dr. Dobb's Journal--><h1>How Do I Use the  Java Plug-In Tool?</h1><p><i>Dr. Dobb's Journal</i> January 2002</p><h3>By Mike Jennings</h3><I>Mike is an independent consultant and lecturer. He is also director of Southgate Software Ltd. He can be reached at <a href="mailto:mike@southgatesoftware.com">mike@southgatesoftware.com</a>.</I><hr><p>In May 1995, Netscape Communications added to its browser a Java interpreter and the ability to parse the newly added <i>&lt;applet&gt;</i> tag, bringing to the Web a standard cross-platform way to do client-side computation and presentation. Microsoft, wary of anything cross platform but still wanting to match Netscape's browser feature for feature, licensed Java technology from Sun Microsystems in March 1996 for its Internet Explorer (IE) browser. </p><p>As the web-browser market evolved, differences between Java virtual machines meant that some applets would behave differently on different browser/operating-system combinations &#151; hardly a "write once, run everywhere" situation. In addition, Microsoft's Java implementation was frozen at Version 1.1 due to a legal battle with Sun, while Java itself moved from Version 1.2 to 1.3 to 1.4, and so on.</p><DDJADVERTISEMENT INLINE><p>To let programmers and end users take full advantage of state-of-the-art Java while keeping behavior consistent, Sun developed a freely available Java plug-in tool. The Java plug-in is available for many OS/browser combinations, most notably Netscape and IE on Windows and Netscape on Linux (<a href="http://java.sun.com/products/plugin/">http://java.sun.com/products/plugin/</a>). In this article, I'll describe how to use the Java plug-in to deploy Java 1.3-enabled applets.</p><h3>What Is a Plug-In?</h3><p>Every group of bytes or object downloaded from web servers by web browsers have properties that browsers can use. The most important property a downloaded object has is its "content type," which is a string indicating that object's Multimedia Internet Message Extensions (MIME) type. For example, a standard web page has a content type of text/html, whereas a JPEG image has a content type of image/jpeg. </p><p>The browser knows how to handle many of these MIME types, but if it encounters a MIME type that it cannot process internally, it looks for an external piece of code registered to handle that type. That piece of code is a plug-in.</p><h3>Object or Embed?</h3><p>Netscape-style plug-ins are activated by specifying an <i>&lt;embed&gt;</i> tag within a web page. Microsoft-style plug-ins are activated by specifying an <i>&lt;object&gt;</i> tag within a web page. The general strategy then is to determine whether to use an <i>&lt;embed&gt;</i> or <i>&lt;object&gt;</i> tag by using JavaScript to "sniff out" the flavor of browser it's running on. Sun provides a tool that automates this process by automatically transforming a web page with an <i>&lt;applet&gt;</i> tag into a page with the appropriate JavaScript "sniffing." The drawback to using the HTML-converter tool is that the generated HTML is quite difficult to edit, especially if you have an applet with many parameters.</p><h3>Boilerplate</h3><p>After examining the output from successive generations of Sun's HTML converter, I've developed a boilerplate for new applets. <A NAME="rl1"><A HREF="#l1">Listing One</A> is the HTML/JavaScript used to launch the SwingSet2 demonstration applet that comes with Sun's JDK 1.3. If you have access to a web server and the SwingSet2.jar file, you can try it on your own web page, or you can try it on my web server at <a href="http://southgatesoftware.com/plugin/SwingSet2.html">http://southgatesoftware.com/plugin/SwingSet2.html</a>.</p><h3>Making It Painless</h3><p>If users browsing the Web with a Netscape browser hit a page with an <i>&lt;embed&gt;</i> tag that refers to a particular plug-in, that plug-in is used automatically if it is already installed; otherwise, users are directed to a page where they can download and install the plug-in if they choose. This page is specified by the <i>pluginspage</i> parameter of the <i>&lt;embed&gt;</i> tag. </p><p>Things are both different and more convenient with Microsoft's IE. If users hit a page with an <i>&lt;object&gt;</i> tag that refers to a not-yet-installed plug-in, IE automatically downloads, extracts, and runs a Windows executable contained in a CAB file referenced by the <i>codebase</i> parameter of the <i>&lt;object&gt;</i> tag. The CAB-contained executable can contain a setup program for the entire plug-in, or contain a smaller executable that downloads the rest of the plug-in from a predetermined location while presenting users with a reassuring download status indicator of the autoinstaller in action. This is exactly what Sun has done with its plug-in autoinstaller. </p><h3>Not for the Faint of Heart</h3><p>The Java plug-in autoinstaller mechanism downloads the Java plug-in from <a href="http://java.sun.com/">http://java.sun.com/</a> and nowhere else. Most of the time this is sufficient, but if you are deploying your applet on an intranet (especially if your intranet has no access to the outside world), you need to change the way the Java plug-in autoinstaller works. In the list of "Available Locations" for downloading, there are two entries: one for java.sun.com and one for southgatesoftware.com. To do this yourself means venturing into the murky waters of CAB files and code signing.</p><h3>CAB Files and Code Signing</h3><p>IE's autoinstall mechanism won't work unless the CAB file referenced by the "codebase" parameter of the <i>&lt;object&gt;</i> tag has been digitally signed. To sign a CAB file, you need to download some code signing utilities from Microsoft, as well as obtain a private key and digital certificate file from a certificate authority such as Verisign or Thawte. Once these files are in place, you sign your CAB file as in <A NAME="rl2"><A HREF="#l2">Listing Two</A>. The signcode utility is available as a free download from Microsoft (<a href="http://msdn.microsoft.com/downloads/default.asp?url=/code/sample.asp?url=/msdn-files/027/000/218/msdncompositedoc.xml">http://msdn.microsoft.com/downloads/default.asp?url=/code/sample.asp?url=/msdn-files/027/000/218/msdncompositedoc.xml</a>). Also, you can search Microsoft's web site for "Authenticode for Internet Explorer."</p><p>To create or modify CAB files, you also need the cabarc utility, which is also available as a free download from Microsoft by the name of "cabinet sdk." (Visual Studio may also include the cabarc utility.)</p><p><b>DDJ</b></p><H4><A NAME="l1">Listing One</H4><pre>&lt;html&gt;&lt;head&gt;&lt;title&gt;SwingSet2&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;center&gt;&lt;SCRIPT LANGUAGE="JavaScript"&gt;&lt;!--    var _info = navigator.userAgent; var _ns = false;    var _ie = (_info.indexOf("MSIE") &gt; 0 &amp;&amp; _info.indexOf("Win") &gt;                              0 &amp;&amp; _info.indexOf("Windows 3.1") &lt; 0);//--&gt;&lt;/SCRIPT&gt;&lt;COMMENT&gt;&lt;SCRIPT LANGUAGE="JavaScript1.1"&gt;&lt;!--    var _ns = (navigator.appName.indexOf("Netscape") &gt;= 0 &amp;&amp;            ((_info.indexOf("Win") &gt; 0 &amp;&amp; _info.indexOf("Win16") &lt; 0 &amp;&amp;            java.lang.System.getProperty("os.version").indexOf("3.5") &lt; 0) ||            (_info.indexOf("Sun") &gt; 0) || (_info.indexOf("Linux") &gt; 0)));    var _ns6 = ((_ns == true) &amp;&amp; (_info.indexOf("Mozilla/5") &gt;= 0));//--&gt;&lt;/SCRIPT&gt;&lt;/COMMENT&gt;&lt;SCRIPT LANGUAGE="JavaScript"&gt;&lt;!--  var i;  var _name="SwingSet2";  var _codebase=".";  var NN=(document.layers ? true : false);  var _embedtype="application/x-java-applet;version=1.3";  var _classid="clsid:8AD9C840-044E-11D1-B3E9-00805F499D93";  var _iecodebase="http://southgatesoftware.com/javaplugin/1.3/                              jinstall-131-win32.cab#Version=1,3,0,0";  var _nspluginspage="http://home.netscape.com/plugins/jvm.html";  var _width="100%";  var _height="100%";  var _class="SwingSet2Applet";  var _align="center";  var _vspace=0;  var _hspace=0;  var _jarfiles="SwingSet2.jar";  var scrap,scrap2;  var appletProps=new Array();  var appletValues=new Array();  appletProps[0]='connectstring';       appletValues[0]="xyz";if (_ie == true)  {    document.writeln('&lt;OBJECT classid="'+_classid+'" ');    document.writeln('WIDTH='+_width+' HEIGHT='+_height);    document.writeln('NAME='+_name+' ALIGN='+_align);    document.writeln('VSPACE='+_vspace+' HSPACE='+_hspace);    document.writeln('codebase="'+_iecodebase+'"&gt;');    document.writeln('&lt;PARAM NAME=CODE VALUE="'+_class+'" &gt;');    document.writeln('&lt;PARAM NAME=CODEBASE VALUE="'+_codebase+'" &gt;');    document.writeln('&lt;PARAM NAME="cache_option" VALUE="Plugin"&gt;');    document.writeln('&lt;PARAM NAME="cache_archive" VALUE="'+_jarfiles+'"&gt;');    document.writeln('&lt;PARAM NAME="NAME" VALUE="'+_name+'" &gt;');    document.writeln('&lt;PARAM NAME="type"                           VALUE="application/x-java-applet;version=1.3"&gt;');    document.writeln('&lt;PARAM NAME="scriptable" VALUE="true"&gt;');    document.writeln('&lt;PARAM NAME="mayscript" VALUE="true"&gt;');    for (i=0;i&lt;appletProps.length;i++)     {      scrap='&lt;PARAM NAME="'+appletProps[i]+'" VALUE="'+appletValues[i]+'" &gt;';      document.writeln(scrap);     }  }else if (_ns == true)  {    if (_ns6 == true)      {        document.writeln('&lt;APPLET ');        document.writeln('CODE = "'+_class+'" ');        document.writeln('CODEBASE = "'+_codebase+'" ');        document.writeln('ARCHIVE = "'+_jarfiles+'" ');        document.writeln('WIDTH='+_width+' ');        document.writeln('HEIGHT='+_height+' ');        document.writeln('ALIGN='+_align+' ');        document.writeln('VSPACE = '+_vspace+' HSPACE = '+_hspace);        document.writeln('&gt;');        for (i=0;i&lt;appletProps.length;i++)          {            scrap='&lt;PARAM NAME="'+appletProps[i]+'"                                            VALUE="'+appletValues[i]+'" &gt;';            document.writeln(scrap);          }        document.writeln('&lt;/applet&gt;');      }    else      {        document.writeln('&lt;EMBED type="'+_embedtype+'"  ');        document.writeln('CODE = "'+_class+'" ');        document.writeln('CODEBASE = "'+_codebase+'" ');        document.writeln('NAME = "'+_name+'" ');        document.writeln('WIDTH='+_width+' HEIGHT='+_height+'                                                 ALIGN='+_align+' ');        document.writeln('VSPACE = '+_vspace+' HSPACE = '+_hspace);        document.writeln('cache_option="Plugin" ');        document.writeln('cache_archive="'+_jarfiles+'" ');        document.writeln('scriptable=true ');        document.writeln('mayscript=true ');        for (i=0;i&lt;appletProps.length;i++)          {            scrap=appletProps[i]+'="'+appletValues[i]+'" ';            document.writeln(scrap);             }        document.writeln('pluginspage="'+_nspluginspage+'"&gt;');        document.writeln('&lt;NOEMBED&gt;');      }  }//--&gt;&lt;/SCRIPT&gt;&lt;/NOEMBED&gt;&lt;/EMBED&gt;&lt;/OBJECT&gt;&lt;/center&gt;You should see a test applet above&lt;/body&gt;&lt;/html&gt;</pre><P><A HREF="#rl1">Back to Article</A></P><H4><A NAME="l2">Listing Two</H4><pre>signcode -v c:\mykey.pvk -spc c:\mycert.spc file.cab -t                         http://timestamp.verisign.com/scripts/timstamp.dll </pre><P><A HREF="#rl2">Back to Article</A></P></body></html>