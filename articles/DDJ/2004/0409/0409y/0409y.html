
<html>
<head>
<title>September, 2004: Infection,  Prevention, and Remedy</title>
</head>

<body BGCOLOR="#ffffff" LINK="#0000ff" VLINK="#330066" ALINK="#ff0000" TEXT="#000000">
<!--Copyright &#169; Dr. Dobb's Journal-->

<h1>Infection,  Prevention, and Remedy</h1>
<p><i>Dr. Dobb's Journal</i> September, 2004</p>
<h2></h2>


<h3>By Jerry Pournelle</h3>


<I>Jerry is a science-fiction writer and senior contributing editor to BYTE.com. You can contact him at jerrypjerrypournelle.com.</I>

<hr>




The other night at the opera, our dinner guests (a lawyer and a management consultant) both complained that their computers had slowed to a crawl and they were getting a million unwanted popup advertisements, often for sex toys and other embarrassing things. It wasn't a crucial embarrassment, but it was annoying.

<p>"Ad-Aware," I said. "Google to find Ad-Aware, download that, run it, and tell me the result." (http://www.lavasoftusa.com/ )</p>

<p>That was a Thursday, opening night of <i>Il Trovotore</i>, with what I thought were new sets but the <i>Los Angeles Times</i> says we've seen them before. Good production, moved fast, no pauses for set changes. They left the rather pointless ballet in, but it was staged well, and I like ballet in opera, although I gather I am in a distinct minority on that. Anyway, we saw our friends at church Sunday, and they were effusive in their gratitude. They each found something like 25 unwanted running processes, over 100 registry keys, and another hundred or so data mining or tracking programs. Ad-Aware eliminated them all.</p>

<p>"It's like we have new machines." I can well believe it. The first time we ran Ad-Aware on my wife's machine, the results were similar. A good half the computer cycles were eaten with unwanted tracking processes, and she couldn't go to the Internet without getting dozens of advertisements, some for the most anatomically amazing stuff. Ad-Aware halved the time it took to compile her reading program, and was even more effective in speeding up Internet access and browsing.</p>

<p>So what's going on here? What are these programs, how do they get on your machines, and do they do you any good?</p>

<p>From http://www.spychecker.com/ spyware.html, which is as good a source of information as any:</p>

<blockquote>
Spyware is Internet jargon for Advertising Supported software (Adware). It is a way for shareware authors to make money from a product, other than by selling it to the users. There are several large media companies that offer them to place banner ads in their products in exchange for a portion of the revenue from banner sales. This way, you don't have to pay for the software and the developers are still getting paid. If you find the banners annoying, there is usually an option to remove them, by paying the regular licensing fee.<br>

</blockquote>

<p>The problem is that they don't always give you an option to remove them, and the spyware programs gather information about your web-browsing habits and "phone home" to report it. Other programs take that information and feed you popup advertisements of things they think you want. In theory they don't send you anything you haven't given some indication of wanting. In practice, if you ever got to a pornographic web site&#151;and it's not hard to do, because pornographers are forever taking names as close to a popular web site name as they can get, and sending you e-mail of offers that have nothing to do with what they are really selling&#151;then you will be put on a list of people who want porn, and you'll get plenty of it. My wife's site is always infected with the stuff, as well as advertisements for enlargement of organs she doesn't possess. </p>

<p>All this is complicated by tamer renditions of Adware that send you advertisements you didn't want, but don't track what you're doing and phone home to report it. There have been lawsuits over whether a particular kind of Adware is Spyware or "malware." I don't propose to be part of that debate.</p>

<p>If I use software, I expect either to pay for it or to have been given a reviewer's key. If I use it and review it and like it enough to keep using it, I often pay for it anyway out of sheer gratitude. If the only way I can use shareware or freeware is to load up my machine with gunk I didn't consent to and don't want, and endure endless exhortations to visit places I don't want to go and buy stuff I wouldn't use for anything, then I'll do without.</p>

<p>For more on this, see Steve Gibson at http://grc.com/optout.htm. Gibson has a strong viewpoint that I don't always agree with, but if the subject interests you then you need to understand his argument&#151;and he offers programs that offer fairly drastic remedies.</p>

<p>And whatever your view of Adware, there are times when you don't want it: With 20 processes running in the background of your machine can slow to a halt, and you may not want a lot of the popup ads for books, movies, cookware, marital aids, cheap clothes, or sex-starved housewives. Ad-Aware will fix most of that.</p>
<h3>SpyBot Versus Ad-Aware</h3>

<p>In addition to Ad-Aware there's Spybot Search and Destroy (http://www.safer-networking.org/), a program that does much the same thing as Ad-Aware. Actually the two are complimentary, in that each finds a few things the other did not. I have never had either of them miss a running process, but I have had Spybot find a couple of registry keys missed by Ad-Aware and vice versa. </p>

<p>Since both these programs are free there's no reason not to have and employ both. In addition, Spybot offers a prevention program that seems to get a lot of this stuff before it installs. Again, not all: I have had Ad-Aware find registry keys that shouldn't be there despite having prevention programs installed.</p>
<h3>Infection, Prevention, and Remedy</h3>

<p>So how does this stuff get into your computer in the first place? </p>

<p>The short answer is that you give it permission to install itself; so in theory you could always refuse such permission, and never have either adware or spyware. In practice it's hard to avoid. For example, you go to a web site for information. It offers you a graph. To see the graph you have to allow popups or ActiveX controls to run. You have no reason to mistrust the web site so you allow that. In comes the malware.</p>

<p>Or you visit a web site to get a new utility you've seen favorably reviewed, download and install it, and it works fine&#151;but it loaded in a spybot. Had you read the license agreement you agreed to when you installed the software, you would have seen somewhere in there a murky statement that, if you paid enough attention, would in fact be giving them permission to put identification and tracking software on your machine.</p>

<p>Or you're just Googling around for information and find your way to an odd web site that wants to show you something interesting, and since you have good antivirus software you let it do that, and since spyware isn't detected by most anti-virus programs (I am not at all sure why; perhaps because spyware is legal, and is thought to serve some useful purpose?) it gets past your virus protection and there you are.</p>

<p>Or you go for a free program to prevent spyware and something worse happens. Read on.</p>
<h3>Ping! </h3>

<p>I have a confession: For years, I ran a machine I used for Internet browsing without Norton or any other antivirus program. I got away with it, too&#151;until last night.</p>

<p>Now in my defense, my machines are all safely behind a pretty good firewall. A trip to Steve Gibson's Shields Up (http://www.grc.com/) shows I am invisible to sniffers, and my router does Network Address Translation (NAT) so that Trojans broadcast to randomly generated IP addresses won't find me, either. </p>

<p>The machine in question has no mail program, so it can't possibly be used to open mail attachments, and popupstopper prevents most of the annoying trips to places I hadn't intended to go. Alas, I did use it last night to test new antispyware programs. I installed half a dozen of them. Then, suddenly, my system popped up a Command Window. "Ping 66.50.102.201," it ordered. Continuously, a new command every second. The pinging began, and issued so fast that the message that the attempt timed out was overwhelmed. Of course, nothing happened because the router blocked the pings from getting out into the world, but it was quite a shock.</p>

<p>I shut down the Command Window. In a minute or so it opened, and the pinging began. Now what?</p>
<h3>Quick Henry, the Norton!</h3>

<p>First thing was to disconnect this machine from the rest of my network. If it was sending out pings, what else might it be sending inside my firewall? In fact, it wasn't doing anything else; but it might have been. After I pulled the Ethernet plug, I reset the system. Then I began installing Norton antivirus. Within a minute or so poor Sable was trying to ping again.</p>

<p>I left Norton trying to install while I opened Startup Manager (http://www.rayslab.com/). I have had a copy of this program on every machine I have owned from the earliest days of Windows to present. It finds just about everything that is told to run at startup, and offers you the chance to disable it (leaving those processes ready to be turned on again), or to delete the startup command entirely.</p>

<p>And there was a program being run from a directory: Windows/System/Systemy7/hack.exe. Now Windows/System doesn't have subdirectories; but here was one. Norton Commander showed it had a lot of programs and initialization files, too. One I remember was pepsi.com. I was still a bit curious so I created a directory called "qfooxxx" where the "xxx" was a random number, and copied all the files to that. One wouldn't copy, and attempts to delete the directory failed, because one of the programs was running. Task manager showed that one, so I killed it. By then Norton was finished installing.</p>

<p>Of course, Norton now wanted to be connected to the Internet. It wanted to register, and it also wanted its updates. Did I dare? The pinging had stopped. I have routers that create a DMZ, an area only weakly protected from the Internet but separated by firewalls from the rest of my internal net; but I didn't have one running just at the moment.</p>

<p>I decided I wasn't that paranoid. I reset, deleted the last traces of Windows\System\Systemy7\ (it went away fine since Startup Manager kept its program from trying to run on startup), and let Norton connect long enough to register and get its updates. Then I pulled the plug on the Ethernet connection and ran the updated Norton antivirus program. There are a lot of files on Sable, so it took a while; but eventually it found that the QFOOXXX directory contained a program delivering the Hacktool.flooder virus. I looked that one up (it helps to have several machines), and discovered it's pretty benign: its sole purpose in life is to make a denial of service attack on a specific address by sending an inordinate number of pings.</p>

<p>Norton found two more virus programs, both in archives of files copied from another machine and stored for safe keeping. The machine that contained them had long been disassembled, but so far as I know it had never been infected, and my guess is that the virus programs had been detected and quarantined by Dr. Solomon's virus remedy, which is what I used until Allan Solomon sold his company. Anyway I saw no point in safekeeping those, and deleted them.</p>
<h3>The Moral of the Story</h3>

<p>Clearly, I was lucky. This is only the second time any of my machines have been hit by a virus or Trojan. The last time was years ago, when an earlier communication system was infected with the Melissa virus: I opened an attachment to a press release from someone I knew. When the machine's hard disk and Ethernet connection lights began blinking furiously, I pulled its plug, so Melissa only mailed about 10 copies of itself to people in my address book. That was long ago, and Melissa was fairly easy to clean up. </p>

<p>My good luck this time is that Sable is one of the machines on which I've installed Windows XP Service Pack 2 Release Candidate 1. Windows XP SP2 is largely devoted to security, and one of the security features is that it can't run command-line programs like ping without opening the command-line window. There are other SP2 security features, some pretty nifty. Windows XP with SP 2 isn't what I'd call secure (and certainly not what my friend Roland would call secure) but it's a lot better than the earlier versions of Windows XP.</p>

<p>And that's my first conclusion: Unless you have good reason not to, if you're running Windows XP, go get Service Pack 2 Release Candidate 1 and install it. I've run it on half a dozen machines here for a month now, and the only negative is a rather minor inconvenience, namely, a 10- to 20-second delay in linking to systems with SP 2 from machines that don't have it yet. SP 2 is more than worthwhile for the security features.</p>

<p>When you build a new machine, you should have all the updates and exploit plugs and critical revisions already downloaded and burned onto a CD. Install them before your new machine ever sees the Internet (or, more importantly, the Internet ever sees your new machine). Then install an antivirus program.</p>

<p>While you are at it, you might consider internally updating Norton AntiVirus. When Norton goes out to the Internet for updates, it puts all those files in its own directory. I haven't tested this and I am not at all sure it would work, but I am tempted to install Norton on a new machine, then XCOPY a newly updated Norton directory over using the /D (copy later files only) switch. The goal isn't to cheat Norton, it's to face the Internet for the first time with a fully updated antivirus program. In any event, update that virus protection instantly.</p>

<p>Eric points out that the proper way to do this would be to use the Norton Live Update Administrator. This lets you designate a single machine to keep an update set of virus definitions that all of the other machines on the network can then point to for their updates. Saves on bandwidth and provides an easy way to keep the data available locally.</p>

<p>Incidentally, Bob Thompson prefers AVG antivirus from grisoft (http://www.grisoft.com/). Thompson claims that it runs so much faster than Norton that it's like having a new machine. I haven't noticed that, but I only have Norton on very fast machines. </p>

<p>My second conclusion is, don't be too eager to try freeware and shareware. That's not a conclusion I like. One of the fun parts of this business is to find really nifty new stuff, like Golden Bow VOPT (http://www.goldenbow.com/), still the best defragging program I know of, and NotePro (http://www.tucows.com/preview/341278.html) before anyone else has ever heard of it. Alas, the bad guys have found that one way to infect other people's computers is to offer freeware or free trials of shareware. They can even tell you to turn off your antivirus program or their little gift to you won't install. They can also turn off your spyware scanner without asking you at all.</p>

<p>I think I had better look into ways to set up at least one computer normally not connected to the rest of Chaos Manor: a system I can use to browse the Internet, and run software as a test in a quarantine environment. I should also get out that router that has a DMZ, so I can test various sharing networks without exposing myself. Between those, I can continue to do silly things so you don't have to without infecting all of Chaos Manor.</p>
<h3>Winding Down</h3>

<p>The Book of the Month is Richard Ben Cramer, <i>How Israel Lost: The Four Questions</i> (Simon &amp; Schuster, 2004; ISBN 0743250281). This book will break your heart. Cramer, an American of Jewish ancestry, was the correspondent for the <i>Philadelphia Inquirer</i> and knows the Middle East better than most anyone now writing about that place. I thought I had an understanding of the problems before I read this book; now I know I didn't understand at all.</p>

<p>The computer book of the month is Joli Ballew and Jeff Duntemann's<i> Degunking Windows </i>(Paraglyph Press, 2004; ISBN 1932111840). It's the usual collection of tricks for speeding up your Windows system and while some of the tricks it shows are obvious, others are not.</p>
<p><b></b></p>
<p><b></b></p>
<p><b>DDJ</b></p>




</body>
</html>