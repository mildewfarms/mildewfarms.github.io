<html><head><title>Feb99: Java Card Application Development</title></head><BODY BGCOLOR="#ffffff" TEXT="#000000" LINK="#0000ff" VLINK="#330066" ALINK="#FF0000">
<!--Copyright &#169; Dr. Dobb's Journal--><h2>Java Card Application Development</h2><h3><i>By Darryl Barnes </i></h3><p><i>Dr. Dobb's Journal</i> February 1999 </p><pre>protected void validatePIN(APDU _apdu){        // get reference to apdu buffer        baBuffer = _apdu.getBuffer();        // get data from terminal        byte bLc = (byte)_apdu.setIncomingAndReceive();        // check length being sent        if(bLc != PIN_LENGTH)            ISOException.throwIt(ISO.SW_WRONG_LENGTH);        // validate PIN        if(pin.check(baBuffer, ISO.OFFSET_CDATA, PIN_LENGTH))            zIsAuthorized = true;        else            ISOException.throwIt(ISO.SW_SECURITY_STATUS_NOT_SATISFIED);}protected void debit(APDU _apdu){        // check if PIN is validated        if(!zIsAuthorized)            ISOException.throwIt(ISO.SW_SECURITY_STATUS_NOT_SATISFIED);        // get reference to apdu buffer        baBuffer = _apdu.getBuffer();        // get data from terminal        byte bLc = (byte)_apdu.setIncomingAndReceive();        // get amount from apdu buffer        short sAmount = Util.getShort(baBuffer, ISO.OFFSET_P1);        // don't allow negative balance        if((sPoints - sAmount) &lt; 0)            sPoints = 0;        else // debit account            sPoints = (short)(sPoints - sAmount);}protected void credit(APDU _apdu){        // check if PIN is validated        if(!zIsAuthorized)            ISOException.throwIt(ISO.SW_SECURITY_STATUS_NOT_SATISFIED);        // get reference to apdu buffer        baBuffer = _apdu.getBuffer();        // get data from terminal        byte bLc = (byte)_apdu.setIncomingAndReceive();        // get amount from apdu buffer        short sAmount = Util.getShort(baBuffer, ISO.OFFSET_P1);        // increment balance        sPoints = (short)(sPoints + sAmount);}protected void getBalance(APDU _apdu){        // check access permissions        if(!zIsAuthorized)            ISOException.throwIt(ISO.SW_SECURITY_STATUS_NOT_SATISFIED);        // get reference to apdu buffer        baBuffer = _apdu.getBuffer();        // put balance value into apdu buffer        Util.setShort(baBuffer, ISO.OFFSET_CDATA, sPoints);        // send balance        _apdu.setOutgoingAndSend(ISO.OFFSET_CDATA, (short)2);}</pre><H4>Example 4: Methods that handle the loyalty functionality.  </H4><p><A HREF="9902g.htm#re4">Back to Article</A></p><HR><I>Copyright &copy; 1999, Dr. Dobb's Journal</I><BR>
</body></html>