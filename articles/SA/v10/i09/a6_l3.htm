<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 4.0//EN">


<HTML>
<HEAD>
<TITLE>v10, i09: Listing 3 sshbkp-receiver</TITLE>
<LINK REL=StyleSheet HREF="../../resource/css/sacdrom.css" TYPE="text/css" TITLE="CSS1">
</HEAD>

<body bgcolor="#ffffff" text="#000000" link="#000000" alink="#669999" vlink="#333366" topmargin=0 leftmargin=0>

<! -- Begin MASTER TABLE -- >
<!center>
<table width=98% cellpadding=0 cellspacing=0 border=0 bgcolor="#ffffff">
  <tr>

<table cellpadding=5 cellspacing=0 border=0>
	<tr>

		<td><span class="navbarLink"><a href="a6.htm">Article</a></span></td>
		<td><span class="navbarLink"><a href="a6_l1.htm">Listing 1</a></span></td>
		<td><span class="navbarLink"><a href="a6_l2.htm">Listing 2</a></span></td>
		<td><span class="navbarLink">Listing 3</span></td>
		<td><a href="../../../../source/SA/2001/sep2001.tar"><b class=codeListing>sep2001.tar</b></a></td>

	</tr>
</table>


</tr>
<tr>
<! -- Begin Content ------ >
    <td valign=top width=527 bgcolor="#ffffff"> 
      <table width=100% cellpadding=15 cellspacing=0 border=0>
<tr>
          <td valign=top> 
            <! -- Insert Content ------ >
            <H1><b>Listing 3 </b><i>sshbkp-receiver</i></h1>
            <p> 
            <pre>
#! /bin/sh
# sshbkp-receiver - receive backup on standard input and save to file
# Copyright (C) 2001 Ed Cashin
#

me=sshbkp-receiver
bkpdir=/usr/local/backup
now=`date +%Y%m%d-%H%M%S`

read title
# --------- title must be less than 128 characters long.
#           only numbers, digits, underscores, and dashes allowed in title.
# 
title_len=`printf $title | wc -c`
if [ `expr $title_len '&lt;' 128` != 1 ] \
   || echo $title | grep '[^-_0-9a-zA-Z]' &gt; /dev/null 2&gt;&amp;1; then
  echo $me Error: bad title for backup 1&gt;&amp;2
  exit 1
fi

if [ ! -d $bkpdir ] || [ ! -w $bkpdir ]; then
  echo $me Error: cannot write to $bkpdir 1&gt;&amp;2
  exit 1
fi

file=$bkpdir/$title-$now
gzip &gt; $file.gz || {
  echo "$me Error: writing backup to file ($file.gz)" 1&gt;&amp;2
  exit 1
}</pre>
          </table></table><br>&nbsp;<br>

<! -- End Content ------ >

<!/center>
<! -- End MASTER TABLE -- >

</body>



<! -- Begin Content ------ >
</html>
