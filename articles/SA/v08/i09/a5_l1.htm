<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 4.0//EN">


<HTML>
<HEAD>
<TITLE>v08, i09: Listing 1</TITLE>
<LINK REL=StyleSheet HREF="../../resource/css/sacdrom.css" TYPE="text/css" TITLE="CSS1">
</HEAD>

<body bgcolor="#ffffff" text="#000000" link="#990000" alink="#669999" vlink="#333366" topmargin=0 leftmargin=0>

<! -- Begin MASTER TABLE -- >
<!center><table width=600 cellpadding=0 cellspacing=0 border=0 bgcolor="#ffffff">

<tr>

<table cellpadding=5 cellspacing=0 border=0>
	<tr>

		<td><span class=navbarLink><a href="a5.htm">Article</a></span></td>
		<td><span class=navbarLink>Listing 1</a></span></td>
		<td><a href="../../../../source/SA/1999/sep99.tar"><b class=codeListing>sep99.tar</b></a></td>

	</tr>
</table>


</tr>
<tr>
<! -- Begin Content ------ >
<td valign=top width=440 bgcolor="#ffffff">
<table width=100% cellpadding=15 cellspacing=0 border=0>
<tr><td valign=top>
<! -- Insert Content ------ >



<H1>Listing 1:  ls.c</H1><p>
<pre>
*** ls.c        Wed May 12 16:27:34 1999 
--- ls.c.orig   Sun Aug  2 18:47:11 1998 
***************
*** 62,68 ****
  #include &lt;string.h&gt;
  #include &lt;unistd.h&gt;
  #include &lt;locale.h&gt;
- #include &lt;syslog.h&gt;
     
  #include "ls.h"
  #include "extern.h"
--- 62,67 ----
***************
*** 111,120 ****
  {
        static char dot[] = ".", *dotav[] = { dot, NULL }; 
        struct winsize win;
!       int ch, fts_options, notused, i; 
!       int argvsize = 0;
        char *p;
-       char *argvbuf;
     
        (void) setlocale(LC_ALL, "");
     
--- 110,117 ----
  {
        static char dot[] = ".", *dotav[] = { dot, NULL }; 
        struct winsize win;
!       int ch, fts_options, notused;
        char *p;
     
        (void) setlocale(LC_ALL, "");
     
***************
*** 136,156 ****
                        termwidth = atoi(p);
        }
     
!   for (i = 0; i &lt; argc; argvsize += strlen(argv[i++])); 
!   argvsize += argc;
!   if (!(argvbuf = malloc(argvsize))) {
!     syslog(LOG_ERR, "can't allocate memory to store command line"); 
!     exit(1);
!   };
!   for (i = 0, *argvbuf = 0; i &lt; argc;) { 
!     strcat(argvbuf, argv[i]);
!     if (++i &lt; argc)
!       strcat(argvbuf, " ");
!   };
! 
!   
!   syslog(LOG_LOCAL5, "BOOM: '%s' run by uid %d on %s", argvbuf, getuid(), 
ttyname(2));   
! 
    /* Root is -A automatically. */
    if (!getuid())
                f_listdot = 1;
     
        fts_options = FTS_PHYSICAL;
--- 132,137 ----
</pre>




<! -- Begin Content ------ >
<br>&nbsp;<br>
</table></center></td>
<! -- End Content ------ >

</table><!/center>
<! -- End MASTER TABLE -- >

</body></html>
