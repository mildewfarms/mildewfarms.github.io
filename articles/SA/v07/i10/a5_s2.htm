<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 4.0//EN">


<HTML>
<HEAD>
<TITLE>v07, i10:  Sidebar 2 : Installing ntp on a Silicon Graphics Inc. 6.2+ Platform</TITLE>
<LINK REL=StyleSheet HREF="../../resource/css/sacdrom.css" TYPE="text/css" TITLE="CSS1">
</HEAD>

<body bgcolor="#ffffff" text="#000000" link="#990000" alink="#669999" vlink="#333366" topmargin=0 leftmargin=0>

<! -- Begin MASTER TABLE -- >
<!center><table width=600 cellpadding=0 cellspacing=0 border=0 bgcolor="#ffffff">

<tr>

<table cellpadding=5 cellspacing=0 border=0>
	<tr>

		<td><span class=navbarLink><a href="a5.htm">Article</a></span></td>
		<td><span class=navbarLink><a href="a5_s1.htm">Sidebar 1</a></span></td>
		<td><span class=navbarLink>Sidebar 2</span></td>
		<td><span class=navbarLink><a href="a5_s3.htm">Sidebar 3</a></span></td>
		<td><span class=navbarLink><a href="a5_t1.htm">Table 1</a></span></td>
	</tr>
	<tr>
		<td><span class=navbarLink><a href="a5_t2.htm">Table 2</a></span></td>
		<td><a href="../../../../source/SA/1998/oct98.tar"><b class=codeListing>oct98.tar</b></a></td>

	</tr>
</table>


</tr>
<tr>
<! -- Begin Content ------ >
<td valign=top width=440 bgcolor="#ffffff">
<table width=100% cellpadding=15 cellspacing=0 border=0>
<tr><td valign=top>





<H1>Sidebar 2 : Installing ntp on a Silicon Graphics Inc. 6.2+ Platform</H1><p><p>
<ol>
<li>  Obtain <B>ntp</B> distribution from:<p>
<p>
<B>   ftp://ftp.udel.edu/pub/ntp/xntpd3.5f.tar.Z</b><p>
<li> Open the package:<p>
<pre>   mkdir ntp
uncompress xntpd3.5f.tar.Z
mv xntpd3.5f.tar ntp
cd ntp
tar xpf xntpd3.5f.tar.Z
</pre><p>
<p><li> Port to IRIX 6.2:<p>
<pre>   make Config
mkdir -p /usr/local/bin /usr/local/etc
</pre><p>
<p><li>  Edit the file <B>Config</B> and add the <B>-cckr</B> flag as an arg for <B>COPTS</B>.<p>
<li>  If desired, edit the <B>ntp</B> poll interval to allow a higher poll rate, in the file <B>include/ntp.h</B>.<p>
<pre>   #define NTP_MINPOLL 1 /* log2 min poll interval (2 s) */
</pre><p>
<p><B>   ntp</B> will dynamically change the poll rate to fall within the min/max range, depending on how well the clock is synchronized. On startup, the poll rate is higher. As <B>ntp</B> runs, the poll rate will decrease because <B>ntp</B> has had time to create a good statistical model of the system clock, including its non-linearities. A NTP_MINPOLL of "1" will set the min poll interval to 2^1=2.<p>
<li>  If desired, modify <B>ntp</B> step threshold (CLOCK.MAX in RFC 1305), in the file <B>include/ntp.h</B> (see RFC 1305, Sections 5.2 and 5.3 for detailed discussions on changing CLOCK.MAX). The example below changes the step size from 128ms (default) to 896 ms:<p>
<pre>   #define CLOCK_MAX_FP 0x0000003b /*max clock offset (s_fp 896 usec ) */
#define CLOCK_MAX_F 0x003ab863 /*max clock offset (l_fp 896 usec) */
</pre><p>
<p>Note that these constants are of type s_fp and l_fp. s_fp is a 32-bit structure; bits 0-15 represent seconds, and bits 15-31 represent fractional seconds. Resolution is 1/2^16 =~ 15.26 ms per bit. l_fp is a similar 64-bit structure, resolution is 1/2^32 =~ 233 psec. The default value is 128 ms (0x20c5 and0x20c49ba6, respectively for s_fp and l_fp). To change this value to 896 ms: <p>
<pre>   896 usec / ( 1/2^16) = 59 = 0x0000003b (s_fp)
896 usec / ( 1/2^32) = 3,848,291 = 0x003ab863 (l_fp)
</pre><p>
<p><li>Create and install the executables:<p>
<pre>  make install
</pre><p>
<p><li>  Create the IRIX ntp startup script <B>/etc/init.d/ntp</B> per Listing 1.<p>
Add the following link:<p>
<pre> ln -s /etc/init.d/ntp /etc/rc2.d/S94ntp
</pre><p>
<p><li>  From a shell, create an IRIX <B>ntp</B> on/off file <B>/etc/config/ntp</B> with the following shell command:<p>
<pre>  echo on &gt; /etc/config/ntp
</pre><p>
<p><li>  The <B>ntp</B> configuration files, <B>ntp.conf</B> are automatically generated by the <B>ntp</B> boot script, so modify that file to change any configurations.<p>
<li>  If you know in advance what the drift values are for the Stratum 1 machines (in <B>ntp.drift</B>), then update the <B>ntp</B> boot script with those values. If you don't know the drift value, update the boot script with a value of "0.000" for drift.<p>
<li>  Ensure the timezone variable is set correctly in <B>/etc/TIMEZONE</B> <p>
<pre>    TZ=EST5EDT
</pre><p>
<p>See <B>timezone </B>(4) for information on this file.<p>
<li>Ensure <B>timed</B>(1M) and <B>timeslave</B>(1M) are not running and won't be restarted on bootup.<p>
<li>  Start <B>ntp</B>, beginning with the lowest numbered stratum machines, either by rebooting or running the startup script.<p>
<li>  The <B>ntp</B> Stratum 1 server will start up, and make something like this entry in the log file <B>ntp.log</b><p>
<pre>
19 Jul 16:35:02 xntpd[543]: logging to file /usr/local/etc/ntp.log
19 Jul 16: 35:02 xntpd[543]: xntpd version=3.5f; Tue Jun 11 07:15:53        PDT 1996 (1)
19 Jul 16: 35:02 xntpd[543]: tickadj = 150, tick = 10000, tvu_maxslew = 14850
19 Jul 16:35:02 xntpd[543]: precision = 10 usec
19 Jul 16:35:19 xntpd[543]: synchronized to LOCAL(0), stratum=3
</pre><p>
<p><li>  The <B>ntp</B> Stratum 2 client(s) will start up, and make something like this entry in the log file <B>ntp.log</B>:<p>
<pre>
19 Jul 15:35:51 xntpd[123]: logging to file /usr/local/etc/ntp.log
19 Jul 15: 35:51 xntpd[123]: xntpd version=3.5f; Tue Jul 16  08:33:09 EDT 1996 (1)
19 Jul 15: 35:51 xntpd[123]: tickadj = 150, tick = 10000, tvu_maxslew = 14850
19 Jul 15:35:51 xntpd[123]: precision = 6 usec
19 Jul 15:36:11 xntpd[123]: synchronized to 192.107.161.120, stratum=5
</pre><p>
<p>Note that 192.107.161.120 is the IP address of the Stratum 1 machine in this example only.<p>
<li>  Check platform synchronization using the following shell commands on each machine:<br>To check the offset between a machine and UTC:<p>
<pre>    /usr/local/bin/xntpdc -c loopinfo|grep offset
</pre><p>
<p>To check the current drift value of a machine: <p>
<pre>    /usr/local/bin/xntpdc -c loopinfo|grep frequency
</pre><p>
<p>To check which server you are synchronized to, and the offset:<p>
<pre>   /usr/local/bin/ntpq -c peers
</pre><p>
<p>Note an asterisk denotes the client is synchronized to the server.<p>
To see miscellaneous <B>ntp</B> variables like poll rate, etc.: <p>
<pre>    /usr/local/bin/ntpq -c readvar
</pre><p>
<p><B>xntpdc </B>and <B>ntpq</B> are supplied with the <B>ntp</B> distribution to aid in debugging. </ol>

<br>&nbsp;<br>
</table></center></td>
<! -- End Content ------ >

</table><!/center>
<! -- End MASTER TABLE -- >

</body></html>
