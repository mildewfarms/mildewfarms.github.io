<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 4.0//EN">


<HTML>
<HEAD>
<TITLE>v11, i02: Listing 3 The status page



</TITLE>
<LINK REL=StyleSheet HREF="../../resource/css/sacdrom.css" TYPE="text/css" TITLE="CSS1">
</HEAD>

<body bgcolor="#ffffff" text="#000000" link="#000000" alink="#669999" vlink="#333366" topmargin=0 leftmargin=0>

<! -- Begin MASTER TABLE -- >
<!center>
<table width=98% cellpadding=0 cellspacing=0 border=0 bgcolor="#ffffff">
  <tr>

<table cellpadding=5 cellspacing=0 border=0>
	<tr>

		<td><span class="navbarLink"><a href="a8.htm">Article</a></span></td>
		<td><span class="navbarLink"><a href="a8_l1.htm">Listing 1</a></span></td>
		<td><span class="navbarLink"><a href="a8_l2.htm">Listing 2</a></span></td>
		<td><span class="navbarLink">Listing 3</span></td>
		<td><span class="navbarLink"><a href="a8_s1.htm">Sidebar 1</a></span></td>
	</tr>
	<tr>
		<td><span class="navbarLink"><a href="a8_s2.htm">Sidebar 2</a></span></td>
		<td><a href="../../../../source/SA/2002/feb2002.tar"><b class=codeListing></b></a></td>

	</tr>
</table>


</tr>
<tr>
<! -- Begin Content ------ >
    <td valign=top width=527 bgcolor="#ffffff"> 
      <table width=100% cellpadding=15 cellspacing=0 border=0>
<tr>
          <td valign=top> 
            <! -- Insert Content ------ >
            <H1><b>Listing 3 </b><i>The status page</i></h1>
            <p> 
            <pre>
 1 #include &lt;stdio.h&gt;
 2 #include &lt;string.h&gt;
 3 #include &lt;errno.h&gt;
 4 #include &lt;sys/file.h&gt;
 5 #include &lt;sys/types.h&gt;
 6 #include &lt;sys/stat.h&gt;
 7 #include &lt;fcntl.h&gt;
 8 
 9 int gen_www_info( char *db_name, double size, double quota )
10 {
11     FILE *file;
12     char www_info_file_path[128];
13     double free = 0;
14     bzero( www_info_file_path, 128 );
15 
16     /*
17      * Generate the complete path the file that the
18      * information will be saved to:
19     */
20     sprintf( www_info_file_path, "%s/%s", "/var/lib/apache/htdocs/quota", db_name );
21 
22     /* Calculate the number of free megabytes: */
23     free = (quota-size);
24 
25     /* Open the file for writing: */
26     if( (file = fopen( www_info_file_path, "w" )) == NULL )
27     {
28         perror( "fdopen(fd,\"w\")" );
29     }
30 
31     /* Ouput the information to the file: */
32     fprintf( file, "&lt;table width=\"30%%\" border=\"0\" cellpadding=\"5\" 
                cellpadding=\"0\"&gt;&lt;tr&gt;&lt;td bgcolor=\"#fced63\" colspan=\"2\" 
                align=\"center\" valign=\"middle\"&gt;&lt;font size=\"4\" 
                face=\"Verdana, Arial, Helvetica, sans-serif\" 
                color=\"#666666\"&gt;Database Status:&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td 
                align=\"right\" valign=\"middle\" width=\"50%%\"&gt;&lt;font 
                size=\"3\" face=\"Verdana, Arial, Helvetica, sans-serif\" 
                color=\"#666666\"&gt;Used Space:&lt;/td&gt;&lt;td align=\"left\" 
                valign=\"middle\" width=\"50%%\"&gt;&lt;font size=\"3\" 
                face=\"Verdana, Arial, Helvetica, sans-serif\" 
                color=\"#666666\"&gt;%.2fMb&lt;/td&gt;&lt;tr&gt;&lt;td align=\"right\" 
                valign=\"middle\"&gt;&lt;font size=\"3\" face=\"Verdana, Arial, 
                Helvetica, sans-serif\" color=\"#666666\"&gt;Free Space:&lt;/td&gt;&lt;td 
                align=\"left\" valign=\"middle\"&gt;&lt;font size=\"3\" 
                face=\"Verdana, Arial, Helvetica, sans-serif\" 
                color=\"#666666\"&gt;%.2fMb&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td align=\"right\" 
                valign=\"middle\"&gt;&lt;font size=\"3\" face=\"Verdana, Arial, 
                Helvetica, sans-serif\" color=\"#666666\"&gt;Total Space:&lt;/td&gt;&lt;td 
                align=\"left\" valign=\"middle\"&gt;&lt;font size=\"3\" 
                face=\"Verdana, Arial, Helvetica, sans-serif\" 
                color=\"#666666\"&gt;%.2fMb&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;", size, free, quota );
33 
34     /* Close the file: */
35     if( (fclose( file )) != 0 )
36     {
37         perror( "fclose(file)" );
38     }
39     
40     /* Everyting seem to be fine, so we'll return 0: */
41     return 0;
42 }
</pre>
          </table></table>&nbsp;

<! -- End Content ------ >

<!/center>
<! -- End MASTER TABLE -- >

</body>



<! -- Begin Content ------ >
</html>
