<html>
<head>
  <title>Listing 2: Generating a Stack Trace in a CGI Script - The Perl Journal, Fall 1997</title>
  <meta name="generator" content=
  "HTML Tidy for Linux/x86 (vers 12 April 2005), see www.w3.org">
  <meta name="vscategory" content="Perl">
  <meta name="vsisbn" content="">
  <meta name="vstitle" content=
  "Listing 2. Generating a Stack Trace in a CGI Script">
  <meta name="vsauthor" content="Nathan Torkington">
  <meta name="searchdescription" content="">
  <meta name="vsimprint" content="The Perl Journal">
  <meta name="vspublisher" content="Earthweb">
  <meta name="vspubdate" content="Fall 1997">
  <!-- update listing #, listing title, and issue  -->

</head>

<body bgcolor="#FFFFFF" text="#000000" link="#DD0000" vlink=
"#DD0000" alink="#DD0000" leftmargin="0" topmargin="0" marginwidth=
"0" marginheight="0">
  <!-- update listing #, listing title, and issue throughout the table -->

  <table cellspacing="0" cellpadding="5" width="100%" border="0">
    <tr align="left" valign="top">
      <td bgcolor="#CCCC99">
        <table width="100%">
          <tr>
            <td valign="top" bgcolor="#CCCC99" nowrap><font face=
            "Arial,Helvetica" size="+1">Listing 2.</font><br>
            <font size="-1" face="Arial,Helvetica" color=
            "#663300"><b>Generating a Stack Trace in a CGI
            Script</b></font><br>
            <font size="-1" face="Arial,Helvetica" color=
            "#663300"><i>Nathan Torkington</i></font></td>

            <td valign="top" bgcolor="#CCCC99"><font size="-1"
            face="Arial,Helvetica" color="#663300">Perfect
            Programming<br>
            The Perl Journal, Fall 1997</font></td>
          </tr>
        </table>
      </td>
    </tr>

    <tr>
      <td>
        <table width="100%">
          <tr>
            <td width="5%" bgcolor="#FFFFFF">&nbsp;</td>

            <td bgcolor="#FFFFFF">
              <font color="#000000">
              <!-- insert code listing or table here -->
               <b>Generating a Stack Trace in a CGI
              Script</b></font>
              <pre>
<font color="#000000">
#!/usr/bin/perl -w



use Devel::DumpStack qw(stack_as_string);

use HTML::Entities;



sub my_die {

   select(STDOUT);$|=1;

   printf(&lt;&lt;"EOF", $?, $!, stack_as_string());

Content-Type: text/html



&lt;HTML&gt;

&lt;HEAD&gt;

&lt;TITLE&gt;System Error&lt;/TITLE&gt;

&lt;/HEAD&gt;



&lt;BODY&gt;

&lt;H1&gt;System Error&lt;/H1&gt;

A seriously bad system error happened:&lt;P&gt;



&lt;B&gt;Exit Status&lt;/B&gt;: %d&lt;BR&gt;

&lt;B&gt;Error String&lt;/B&gt;: %s&lt;P&gt;



&lt;B&gt;Stack Dump&lt;/B&gt;:

&lt;PRE&gt;

%s

&lt;/PRE&gt;



&lt;/BODY&gt;

&lt;/HTML&gt;

EOF

  exit;

}



BEGIN {

  $SIG{_ _WARN_ _} = $SIG{_ _DIE_ _} = \&amp;my_die;

}



$a = undef + 4;

exit;

</font>
</pre><!--  end code listing  -->
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</body>
</html>
