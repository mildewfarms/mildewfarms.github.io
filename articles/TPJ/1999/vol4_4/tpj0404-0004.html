<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Just Another Perl Haiku - The Perl Journal, Winter 1999</title><!-- end head -->
  <meta name="generator" content=
  "HTML Tidy for Linux/x86 (vers 12 April 2005), see www.w3.org">
  <meta name="vscategory" content="Perl">
  <meta name="vsisbn" content="">
  <meta name="vstitle" content="Just Another Perl Haiku">
  <meta name="vsauthor" content="Damian Conway">
  <meta name="searchdescription" content="Just Another Perl Haiku">
  <meta name="vsimprint" content="The Perl Journal">
  <meta name="vspublisher" content="Earthweb">
  <meta name="vspubdate" content="Winter 1999">
  <!-- always update the article title and issue -->

</head>

<body>
  <font face="verdana" size="1">Issue 16, Winter 1999</font>

  <h2 align="center">Just Another Perl Haiku</h2>

  <h4><i>Damian Conway</i></h4>
  <!-- packages described, if necessary -->

  <div align="center">
    <table border="1" cellspacing="0" cellpadding="5">
      <tr>
        <td bgcolor="#CCCC99">
          <div align="center">
            <b>Packages Used</b>
          </div>
        </td>
      </tr>

      <tr>
        <td>Perl 5.005 or later ..CPAN<br>
        Coy 0.04 or later ..CPAN</td>
      </tr>
    </table>
  </div>

  <p>I often think of Perl programs as the haiku of the software
  world.</p>

  <p>Both are compact, dense, powerful, and frequently a little
  obscure.(Hmmm...wait a minute...that's also a fairly good
  description of me! )</p>

  <p>So it's no surprise that haiku are popular with Perl
  programmers.</p>

  <p>Even so, I had no idea <i>how</i> popular, until I wrote
  Coy.</p>

  <p>What is Coy? Let me quote from the pod file that comes with
  the extension.(http://www.perl.com/CPAN/authors/id/DCONWAY/.)</p>

  <blockquote>
    <i>Error messages<br>
    strewn across my terminal.<br>
    A vein starts to throb.</i>
  </blockquote>

  <blockquote>
    Their reproof adds the<br>
    injury of insult to<br>
    the shame of failure.
  </blockquote>

  <blockquote>
    When a program dies<br>
    what you need is a moment<br>
    of serenity.
  </blockquote>

  <blockquote>
    The Coy.pm<br>
    module brings tranquillity<br>
    to your debugging.
  </blockquote>

  <blockquote>
    The module alters<br>
    the behavior of <tt>die</tt> and<br>
    <tt>warn</tt> (and <tt>croak</tt> and <tt>carp</tt>).
  </blockquote>

  <blockquote>
    Like Carp.pm,<br>
    Coy reports errors from the<br>
    caller's point of view.<br>
    But it prefaces<br>
    the bad news of failure with<br>
    a soothing poem.
  </blockquote>

  <h3>The Tao of haiku</h3>

  <p>A haiku is a<br>
  short poem that's 17<br>
  syllables in length.</p>

  <p>Traditionally,<br>
  its topic is an image<br>
  taken from nature</p>

  <p>(though the Japanese<br>
  understanding of "nature"<br>
  is subtle and broad).</p>

  <p>True haiku don't try<br>
  to make a point; they merely<br>
  convey an image.</p>

  <p>Of course, the image<br>
  itself may make a point, but<br>
  that's not the same thing!</p>

  <p>The form developed<br>
  in the 1600's from<br>
  the longer <i>tanka</i>.</p>

  <p>In fact, a haiku<br>
  is the <i>hokku</i> (the "starting<br>
  verse") of a tanka.</p>

  <p>The first adept of<br>
  the haiku format was the<br>
  Zen poet Basho.</p>

  <p>His best known poem<br>
  captures the wonder of an<br>
  everyday event.</p>

  <p>It's: <i>furike ya<br>
  kawazu tabikomu<br>
  mizu no oto</i>.</p>

  <p>Which is normally<br>
  translated as: <i>An old pond.<br>
  A frog jumps in. Plop!</i><br>
  As you see, there's no<br>
  message. The haiku is a<br>
  pure evocation.</p>

  <h3>Haiku on-line</h3>

  <p>The 5-7-5<br>
  art form is widely practiced<br>
  on the Internet.</p>

  <p>There are many sites<br>
  devoted to haiku and<br>
  to related styles</p>

  <p>(most notably, the<br>
  satirical variants<br>
  known as <i>senryu</i>).</p>

  <p>The easiest place<br>
  to start is with a search of<br>
  the Yahoo index.<br>
  (http://search.yahoo.com/bin/search?p=haiku)</p>

  <p>Jane Reichhold also<br>
  gives a superb summary<br>
  (http://www.faximum.com/aha.d/haidefjr.htm)<br>
  of the haiku form.</p>

  <p>And for a deeper<br>
  view, Keiko Imaoka's<br>
  page(http://www.faximum.com/aha.d/keirule.htm)<br>
  is unsurpassed.</p>

  <p>There is even a<br>
  strictly SF variant<br>
  known as "SciFaiku."<br>
  (http://www.scifaiku.com/)</p>

  <h3>Artificial haiku</h3>

  <p>Many websites now<br>
  also feature haiku that<br>
  are not carbon-based.</p>

  <p>In fact, the Web is<br>
  awash with generators<br>
  of Japanese verse.</p>

  <p>A simple search<br>
  (http://www.altavista.com/cgi-bin/query?q=%2Bgenerate+%2Bhaiku )
  finds<br>
  nearly 3000 links for:<br>
  "<tt>+generate +haiku</tt>".</p>

  <p>Silicon Graphics<br>
  even rigged a lava-lamp<br>
  (http://lavarand.sgi.com/cgi-bin/haiku.cgi )<br>
  to build (bad) haiku:</p>

  <blockquote>
    <i>i think i'm wasted<br>
    i'll wax the cats. cool clear earth<br>
    pigs are smarter. crash</i>
  </blockquote>

  <p>(That is one of its<br>
  clearer efforts. Mostly it<br>
  just spouts gibberish.)</p>

  <p>In contrast, Garret<br>
  Kaminaga makes use of<br>
  a "haiku grammar".<br>
  (http://www.cs.stanford.edu/~zelenski/rsg/grammars/Haiku.g)</p>

  <p>Its simple rules (see<br>
  <a href="tpj0404-0004a.html"><b>Figure 1</b></a>) expand to
  give<br>
  correct syllables.</p>

  <p>But they don't encode<br>
  any English grammar, so<br>
  the results are poor:</p>

  <blockquote>
    <i>empty computer<br>
    yakitori to empty<br>
    your chrysanthemums</i>
  </blockquote>

  <p>Richard Decker and<br>
  Stuart Hirshfield also use<br>
  grammars for haiku.)<br>
  (
  http://odyssey.thomson.com/brookscole/compsci/aeonline/course/9/2/index.html</p>

  <p>But theirs are based on<br>
  real English sentence structures<br>
  (as in <a href="tpj0404-0004b.html"><b>Figure 2</b></a>).</p>

  <p>As a result, they<br>
  generate quite plausible<br>
  (and lovely) haiku:</p>

  <blockquote>
    <i>A liquid summer<br>
    wind. Under the gusty sky<br>
    a storm whispers.</i> [sic]
  </blockquote>

  <p>Unfortunately,<br>
  their English grammar doesn't<br>
  encode syllables.</p>

  <p>Consequently, most<br>
  of the haiku they produce<br>
  don't scan correctly.</p>

  <p>As these samples show,<br>
  a haiku generator<br>
  must balance two things:<br>
  It must use correct<br>
  English syntax and it has<br>
  to track syllables.</p>

  <p>As we'll see, Coy is<br>
  built around those two constraints:<br>
  grammar <i>and</i> meter.</p>

  <h3>The Coy module</h3>

  <p>Coy is simple to<br>
  use: just add <tt>use Coy</tt>; to your<br>
  existing program.</p>

  <p>Hereafter, any<br>
  calls to <tt>die</tt>, <tt>warn</tt>, <tt>croak</tt>, or
  <tt>carp</tt><br>
  produce a haiku.</p>

  <p>This magic is wrought<br>
  by assigning a handler<br>
  to <tt>$SIG{ __ DIE __ }</tt>.</p>

  <p>That handler passes<br>
  the string it receives to Coy's<br>
  verse generator.</p>

  <p>It then re-calls <tt>die</tt><br>
  with the resulting haiku<br>
  as its argument.</p>

  <p>The same approach is<br>
  applied to <tt>$SIG{ __WARN__ }</tt>,<br>
  to catch warnings too.</p>

  <p>Apart from handlers,<br>
  use <tt>Coy</tt> also exports two<br>
  extra subroutines.</p>

  <p>These subs, <tt>transcend()</tt> and<br>
  <tt>enlighten()</tt>, can lend your code<br>
  a Zen overtone.</p>

  <p>(But internally,<br>
  they are each just a wrapper<br>
  around <tt>croak</tt> or <tt>carp</tt>.)</p>

  <h3>A note about the name</h3>

  <p>Just in case there's still<br>
  anyone in the U.S.<br>
  who <i>hasn't</i> sent mail...</p>

  <p>Yes, I know you folks<br>
  spell the fish the same way as<br>
  the Japanese: <i>koi</i>.</p>

  <p>We Aussies, like our<br>
  British forebears, prefer to<br>
  anglicize it: <i>coy</i>.</p>

  <p>And the triple pun<br>
  ("coy: (a) fish; (b) calm; (c) trap")<br>
  needs the English form.</p>

  <p>But if you insist,<br>
  you can always dash this off<br>
  from your command line:</p>

  <p><tt>perl -&gt; Koi.pm<br>
  print STDOUT "use Coy; 1;"<br>
  ^D (or Z)</tt></p>

  <h3>Inside the Coy module</h3>

  <p>Coy's generator<br>
  is data-driven and has<br>
  five main components:</p>

  <p>&bull; A cross-linkedlist of<br>
  words that provides its basic<br>
  vocabulary;</p>

  <p>&bull; A mechanism<br>
  for selecting relevant<br>
  words for each haiku;</p>

  <p>&bull; A set of sentence<br>
  templates that ensure the text<br>
  is grammatical;</p>

  <p>&bull; A set of routines<br>
  that correctly inflect words<br>
  within each sentence;<br></p>

  <p>&bull; An algorithmic<br>
  syllable counter, which checks<br>
  that each haiku scans.</p>

  <p>We'll briefly look at<br>
  how each of these components<br>
  goes about its task.</p>

  <h3>Mere words</h3>

  <p>Ultimately, a<br>
  haiku is just sequence<br>
  of well-chosen words.</p>

  <p>Coy's words are stored in<br>
  a hierarchical, cross-linked<br>
  vocabulary.</p>

  <p><a href="tpj0404-0004c.html"><b>Figure 3</b></a> shows an<br>
  abbreviated sample<br>
  of that database.</p>

  <p>The top level of<br>
  word categorization<br>
  is by subject nouns.</p>

  <p>For each such noun, a<br>
  set of global constraints and<br>
  sounds is then given.</p>

  <p>The sounds are used as<br>
  verbs to generate clauses<br>
  describing noises.</p>

  <p>In addition, a<br>
  list of more general verb forms<br>
  ("<tt>act</tt>") is specified.</p>

  <p>Each such verb, listed<br>
  in third person singular,<br>
  may take attributes.</p>

  <p>These attributes list<br>
  constraints on the verb's usage<br>
  (such as location).</p>

  <p>The entry for "<tt>duck</tt>" =&gt;<br>
  "<tt>swims</tt>", for instance, locates it<br>
  as "<tt>suraquatic</tt>".</p>

  <p>Other attributes<br>
  limit the subject count for<br>
  particular verbs.</p>

  <p>"<tt>lover</tt>" = &amp;agt; "<tt>kisses</tt>", for<br>
  example, is limited<br>
  to exactly 2.<br>
  (What can I say? It. s a very conservative style of poetry.)</p>

  <h3>Random havesting</h3>

  <p>Coy's next component<br>
  is an association<br>
  selection system.</p>

  <p>This system ensures<br>
  that the haiku relates to<br>
  the error message.</p>

  <p>The message is first<br>
  scanned to find significant<br>
  words (principally nouns).</p>

  <p>These words are found by<br>
  deleting "stop words" from the original text.</p>

  <p>"Stops" are words such as<br>
  <i>the, to, it</i>, and the like, that<br>
  don't convey content.</p>

  <p>The remaining words<br>
  become a "filter" for the<br>
  vocabulary.</p>

  <p>Each word selected<br>
  for the haiku is compared<br>
  against this filter.</p>

  <p>If the selected<br>
  word's associations don't<br>
  match, it's rejected.</p>

  <p>This leads to problems<br>
  though, if the filter words are<br>
  too unusual.</p>

  <p>In extreme cases,<br>
  they may filter out the whole<br>
  vocabulary.</p>

  <p>To prevent this, Coy<br>
  can turn the word filter off<br>
  temporarily.</p>

  <h3>Filling in the blanks</h3>

  <p>The third component<br>
  generates the haiku, by<br>
  filling in templates.</p>

  <p>Those templates encode<br>
  various grammatical<br>
  structures for haiku.</p>

  <p>The generator<br>
  selects one and fills it in<br>
  with relevant words.</p>

  <p><a href="tpj0404-0004d.html"><b>Figure 4</b></a> shows a<br>
  few of the grammatical<br>
  templates Coy uses.</p>

  <p>Note that the grammar<br>
  has no terminals: they're drawn<br>
  from the database.</p>

  <p>Templates are chosen<br>
  at random, as often as<br>
  needed (<a href="tpj0404-0004d.html">see <b>Figure
  4</b></a>).</p>

  <p>The chosen template<br>
  is then filled in with "filtered"<br>
  semi-random words.</p>

  <p>The noun to be used<br>
  is randomly selected,<br>
  and constrains the verb.</p>

  <p>Any later parts<br>
  of the grammar are likewise<br>
  constrained by that verb.</p>

  <p>These are typically<br>
  adverbial phrases of<br>
  place or direction.</p>

  <p>For instance, suppose<br>
  the filtered noun chosen is<br>
  the word <i>hummingbird</i>.</p>

  <p>Immediately<br>
  this constrains the verb to words<br>
  like <i>flies, darts,</i> or <i>nests</i>.</p>

  <p>If <i>flies</i> were chosen,<br>
  that would then constrain the place<br>
  to be aerial.</p>

  <p>Whereas, if <i>nests</i> were<br>
  chosen, the place would have to<br>
  be arboreal.</p>

  <p>Note that Coy needs no<br>
  A.I. techniques to enforce<br>
  these sequenced constraints.</p>

  <p>The hierarchical<br>
  vocabulary structure<br>
  itself ensures them.</p>

  <h3>The other type of grammar</h3>

  <p>But selecting the<br>
  right parts of speech. --and words to<br>
  match. --is not enough.</p>

  <p>The module must then<br>
  adjust the selected words'<br>
  grammatical form.</p>

  <p>Specifically, the<br>
  words used must be inflected<br>
  for number and tense.</p>

  <p>Lingua::EN::Inflect<br>
  is used to supply correct<br>
  noun/verb agreement.</p>

  <p>Each time a grammar<br>
  template is filled, Coy selects<br>
  a random number.</p>

  <p>That number becomes<br>
  the number of subjects for<br>
  the current sentence.</p>

  <p>If 1 is chosen,<br>
  the subject noun and its verb<br>
  are left as they are.</p>

  <p>Otherwise, Inflect's<br>
  PL sub is used to change<br>
  them both to plurals.</p>

  <p>Lingua::EN::Inflect<br>
  can also inflect present<br>
  to continuous.</p>

  <p>The new <tt>PART</tt> sub takes<br>
  a singular verb and forms<br>
  its participle.</p>

  <p>This is useful to<br>
  increase the variety<br>
  of sentences used.</p>

  <p>Thus, sometimes <i>birds fly</i>,<br>
  some <i>birds</i> are <i>flying</i>, and the<br>
  rest are <i>flying birds</i>.</p>

  <p>Inflecting present<br>
  participles is harder<br>
  than it might first seem.</p>

  <p>Consider the verbs:<br>
  <i>bat, combat, eat, bite, fulfil(l),<br>
  lie, sortie,</i> and <i>ski</i>.</p>

  <p>Each adds <i>-ing</i> after<br>
  it (all verbs do), but each root<br>
  inflects differently.</p>

  <p>The rules are complex,<br>
  but the <tt>PART</tt> sub knows them all,<br>
  and can apply them.</p>

  <h3>Counting the beat</h3>

  <p>The four components<br>
  above ensure the haiku<br>
  parses and makes sense.</p>

  <p>However, there's no<br>
  guarantee that the result<br>
  scans 5-7-5.</p>

  <p>To ensure perfect<br>
  meter, each selected word's<br>
  syllables are checked.<br></p>

  <p>This occurs while the<br>
  grammar templates are filled in<br>
  (as words are filtered).</p>

  <p>The selector tracks<br>
  the progressive syllable<br>
  count of the words used.</p>

  <p>If the count exceeds<br>
  17, the selector<br>
  can reject a word.</p>

  <p>The selection can<br>
  also backtrack further, if<br>
  that's necessary.</p>

  <p>In some cases this<br>
  might cause the template itself<br>
  to be rejected.</p>

  <p>The template-filling<br>
  process then repeats until<br>
  the full haiku scans.</p>

  <h3>But does the bear dance?</h3>

  <p>By now you're thinking<br>
  "Who cares how the magic works:<br>
  Show me the MONEY!"</p>

  <p>So here are a few<br>
  of Coy's more interesting<br>
  creative efforts...</p>

  <p>Given the fatal<br>
  error: <tt>die "Bad argument"</tt>,<br>
  Coy replied with this:</p>

  <blockquote>
    <i>A pair of lovers<br>
    quarrel beside a stream. Four<br>
    thrushes fly away.</i>
  </blockquote>

  <p>Note the allusion<br>
  to the <i>bad argument</i> in<br>
  the error message.</p>

  <p>Haiku are never<br>
  repeated. A second <tt>die<br>
  "Bad argument"</tt> gave:</p>

  <blockquote>
    <i>Two old men fighting<br>
    under a sycamore tree.<br>
    Homer Simpson sighs.</i>
  </blockquote>

  <p>In contrast, for a<br>
  <tt>croak "Missing file"</tt>, Coy captured<br>
  the sense of loss with:</p>

  <blockquote>
    <i>Bankei weeping by<br>
    a lake. Ryonen dying.<br>
    Seven howling bears.</i>
  </blockquote>

  <p>Coy can't always reach<br>
  this exalted level of<br>
  (oblique) relevance.<br></p>

  <p>For example, it<br>
  also produced this response<br>
  to <tt>croak "Missing file"</tt>:</p>

  <blockquote>
    <i>A swallow nesting<br>
    in the branches of an elm<br>
    tree. A waiting fox.</i>
  </blockquote>

  <p>Sometimes Coy's output<br>
  suggests a macabre sense<br>
  of humor, as in:</p>

  <blockquote>
    <i>A wolf leaps under<br>
    a willow. Two old men sit<br>
    under the willow.</i>
  </blockquote>

  <p>In other cases,<br>
  its inscrutability<br>
  is most authentic:</p>

  <blockquote>
    <i>Two young women near<br>
    Bill Clinton's office. A cat<br>
    waiting by a pond.</i>
  </blockquote>

  <h3>Extending the module</h3>

  <p>Eventually<br>
  even Coy's built-on-the-fly<br>
  haiku get boring.<br></p>

  <p>The module only<br>
  has a small set of words from<br>
  which to build poems.</p>

  <p>After a while the<br>
  same topics start recurring--<br>
  Coy's "theme" emerges.</p>

  <p>True to its roots, Coy<br>
  always writes about fish, birds,<br>
  animals, and trees.</p>

  <p>That fixation on<br>
  certain flora and fauna<br>
  soon begins to grate.</p>

  <p>So Coy provides a<br>
  way to configure its own<br>
  vocabulary.</p>

  <p>Any code placed in<br>
  <i><tt>~/.coyrc</tt></i><br>
  runs at compile-time.</p>

  <p>You can use that file<br>
  to extend Coy.pm's<br>
  mental horizons.</p>

  <p><a href="tpj0404-0004e.html"><b>Figure 5</b></a> shows how<br>
  to add, for example, a<br>
  Jedi leitmotif.</p>

  <h3>Is there a poet in the house?</h3>

  <p>At TPC3<br>
  this year I launched a new book<br>
  about OO Perl.(http://www.manning.com/Conway/)</p>

  <p>I had two copies<br>
  to give away, so I ran<br>
  a haiku contest.</p>

  <p>At my talk on Coy<br>
  I asked audience to<br>
  write me some poems.</p>

  <p>The two cleverest<br>
  (IMHO)<br>
  would each get a book.</p>

  <p>David Adler won<br>
  the first, by demonstrating<br>
  that blackmail's an Art:</p>

  <blockquote>
    <i>On-the-spot haiku<br>
    written on a lady's back.<br>
    Know we have
    pictures!<br></i>(http://www.stonehenge.com/merlyn/Pictures/99-08-TPC3/Day-2-Sun/?start=62&amp;end=64)
  </blockquote>

  <p>Dean Hudson won by<br>
  coercion too, though his was<br>
  metaphysical:</p>

  <blockquote>
    <i>Your book entices,<br>
    fork it over, friend Aussie.<br>
    Jedi mind tricks work.</i>
  </blockquote>

  <h3>It seemed like a good<br>
  idea at the time</h3>

  <p>Picking those two gems<br>
  from the hoard of glittering<br>
  entries was great fun.</p>

  <p>So I decided<br>
  to expand the contest to<br>
  the whole conference.</p>

  <p>I knew I needed<br>
  help: Mark-Jason Dominus<br>
  and Elaine Ashton.</p>

  <p>They kindly agreed<br>
  to lend their artistic good<br>
  taste as co-judges.</p>

  <p>Then Tim O'Reilly<br>
  generously donated<br>
  prizes: book vouchers.</p>

  <p>Next we collected<br>
  haiku from the 800<br>
  or more delegates.</p>

  <p>From over fifty<br>
  entries we selected two<br>
  as the joint winners.</p>

  <p>Michael Schwern triumphed<br>
  with a meta-haiku that's<br>
  true Perl poetry:</p>

  <p><tt># Life ends with a crash<br>
  require 'Coy.pm';<br>
  &amp;laughter while $I, die;</tt></p>

  <p>Kevin Hackman won<br>
  too, for this chill augury<br>
  against the Dark Side:</p>

  <p>&nbsp;&nbsp;<i>fall leaves blanket ground<br>
  redmond dreams darkly -- beware!<br>
  winter brings penguins</i></p>

  <h3>Your chance to win</h3>

  <p>Not content to rest<br>
  on our laureates, we want<br>
  to expand our scope.</p>

  <p>We plan to run a<br>
  haiku contest for the whole<br>
  Perl community.</p>

  <p>And in the spirit<br>
  of form following function,<br>
  we've entitled it:</p>

  <blockquote>
    <i>Camelinguistic<br>
    Heptadecasyllable<br>
    Ideogeny</i>
  </blockquote>

  <p>...or the <i>CHI</i>, for short.<br>
  (You can decide if that's Greek<br>
  or Chinese</p>

  <p>The contest runs from<br>
  early 2000 till the<br>
  next Perl Conference.</p>

  <p>Six prizes will be<br>
  offered. They'll be awarded<br>
  at the conference.</p>

  <p>Watch the Perl newsgroups<br>
  in the next month for details<br>
  for how to enter.</p>

  <p><a href="tpj0404-0004f.html"><b>Perl Poem: down.pl</b></a></p>

  <p>_ _END_ _</p>
  <hr>
  <i>Damian Conway<br>
  is stuck inside a haiku<br>
  and he can't get out!</i> <!-- end of article -->
   <!-- end of file -->
</body>
</html>
